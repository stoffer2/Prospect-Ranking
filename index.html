<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rankle – Consensus MLB Prospect Rankings</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&family=Oswald:wght@500;600&display=swap" rel="stylesheet">
<style>
 :root {
    --bg-deep:    #f0f7f3;  /* primary page background (light sage) */
    --bg-card:    #f5faf8;  /* cards / panels */
    --bg-row:     #f9fcfb;  /* table row odd */
    --bg-row-alt: #f5faf8;  /* table row even */
    --border:     #c3d5cc;  /* soft green-gray border */
    --text-hi:    #11241e;  /* main text – deep green charcoal */
    --text-mid:   #3c5e50;  /* body copy / secondary */
    --text-lo:    #7a9a8c;  /* subtle labels */
    --accent:     #1b4d3e;  /* forest green from logo */
    --accent-hi:  #2f7f63;  /* brighter green for highlights */
    --gold:       #f59e0b;  /* keep warm gold */
    --green:      #3bb38a;  /* success / positive */
    --red:        #f87171;
    --purple:     #a78bfa;
}

* { margin:0; padding:0; box-sizing:border-box; }

html { overflow-x: hidden; }
body {
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    line-height: 1.6;
    background: var(--bg-deep);
    color: var(--text-hi);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
    overflow-x: hidden;
}

/* ── HEADER ── */
header {
    position: sticky;
    position: -webkit-sticky;
    top: 0;
    z-index: 100;
    background: rgba(240,247,243,0.96);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    border-top: 3px solid var(--accent);
    box-shadow: 0 2px 12px rgba(0,0,0,.08);
    padding: 0 2rem;
    min-height: 88px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1.5rem;
}
.header-logo-wrap {
    flex-shrink: 0;
    display: flex;
    align-items: center;
}
.header-logo-wrap img {
    height: 56px;
    width: auto;
    max-width: 220px;
    object-fit: contain;
    display: block;
}
.logo-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 3rem;
    letter-spacing: 4px;
    line-height: 1;
    background: linear-gradient(135deg, #fef3c7 0%, #f59e0b 40%, #d97706 100%);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    filter: drop-shadow(0 2px 6px rgba(245,158,11,0.4));
    flex-shrink: 0;
}
.header-right { display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0; }
.btn-pro {
    background: linear-gradient(135deg,#1b4d3e,#2f7f63);
    color:#fff;
    border: 2px solid rgba(47, 127, 99, 0.7);
    padding: 0.5rem 1.15rem;
    border-radius: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    letter-spacing: 0.3px;
    display: inline-flex;
    align-items: center;
    line-height: 1;
    transition: transform .15s, box-shadow .15s;
}
.btn-pro:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 4px 16px rgba(28,92,71,.7); }
.btn-pro:focus-visible, .btn-upload-roster:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--accent); }

/* ── HERO ── */
.hero {
    position: relative;
    background: linear-gradient(160deg, #e8f3ed 0%, #f5faf8 60%, #f0f7f3 100%);
    border-bottom: 1px solid var(--border);
    padding: 2.5rem 2rem 3rem;
    margin-bottom: 0.5rem;
    overflow: hidden;
}
.hero::before {
    content: '';
    position: absolute; inset: 0;
    background-image: radial-gradient(circle at 20% 40%, rgba(44,112,88,0.18) 0%, transparent 55%),
                      radial-gradient(circle at 80% 10%, rgba(245,158,11,0.07) 0%, transparent 45%);
    pointer-events: none;
}
.hero::after {
    content: '';
    position: absolute; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%231e2a40' fill-opacity='0.4'%3E%3Ccircle cx='20' cy='20' r='0.5'/%3E%3C/g%3E%3C/svg%3E");
    opacity: 0.6;
    pointer-events: none;
}
.hero-inner {
    position: relative; z-index: 1;
    max-width: 1200px; margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 3rem;
    align-items: center;
    text-align: left;
}
.hero-content { max-width: 520px; }
.hero-label {
    font-size: 0.7rem; font-weight: 600; text-transform: uppercase;
    letter-spacing: 2.5px; color: var(--accent-hi);
    margin-bottom: 0.5rem;
}
.hero h1 {
    font-family: 'Oswald', sans-serif;
    font-size: 2.75rem; font-weight: 600;
    letter-spacing: 2px; line-height: 1.1;
    margin-bottom: 0.75rem;
}
.hero h1 .highlight { color: var(--accent-hi); }
.hero-desc { color: var(--text-mid); font-size: 0.95rem; line-height: 1.6; margin-bottom: 1.25rem; }
.hero-pills {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
}
.hero-pill {
    font-size: 0.72rem; font-weight: 600;
    color: var(--text-mid);
    letter-spacing: 0.6px;
    padding: 0.35rem 0.7rem;
    background: #e8f3ed;
    border: 1px solid var(--border);
    border-radius: 6px;
}
.hero-preview {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem 1.5rem;
    min-width: 240px;
    position: relative;
    box-shadow: 0 4px 24px rgba(0,0,0,.15);
}
.hero-preview-title {
    font-size: 0.65rem; font-weight: 700; text-transform: uppercase;
    letter-spacing: 1.5px; color: var(--text-lo);
    margin-bottom: 0.75rem;
}
.hero-legend { display: flex; flex-direction: column; gap: 0.75rem; }
.hero-legend-item {
    font-size: 0.7rem;
    color: var(--text-mid);
    line-height: 1.4;
}
.hero-legend-item strong { color: var(--text-hi); font-weight: 600; }
.hero-legend-item .cons-dots { display: inline-flex; gap: 0.2rem; margin-left: 0.25rem; vertical-align: middle; }
.hero-legend-item .cons-dot { width: 6px; height: 6px; }
.hero-legend-note {
    display: block;
    font-size: 0.62rem;
    color: var(--text-lo);
    margin-top: 0.2rem;
}
.hero-legend-vols { display: flex; gap: 0.35rem; flex-wrap: wrap; margin-top: 0.2rem; }

@media (max-width: 900px) {
    .hero-inner { grid-template-columns: 1fr; text-align: center; }
    .hero-content { max-width: 100%; }
    .hero-pills { justify-content: center; }
    .hero-preview { justify-self: center; }
}

/* ── FILTER BAR ── */
.filter-bar {
    max-width: 1100px; margin: 2rem auto 1.5rem;
    padding: 0 1.5rem;
    display: flex; gap: 0.75rem; align-items: flex-end; flex-wrap: wrap;
}
.filter-group { display:flex; flex-direction:column; gap:.3rem; flex:1; min-width:140px; }
.filter-group label { font-size:.7rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-lo); }
.filter-group input,
.filter-group select {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem 0.75rem;
    color: var(--text-hi);
    font-size: 0.85rem;
    font-family: inherit;
    outline: none;
    transition: border-color .2s, box-shadow .2s;
}
.filter-group input:focus,
.filter-group select:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(44,112,88,.35); }
.filter-group input:focus-visible,
.filter-group select:focus-visible { outline: none; }
.filter-group input::placeholder { color:var(--text-lo); }

/* ── TABLE ── */
/* No overflow on .table-wrap so thead sticky is relative to viewport, not a scroll box */
.table-wrap {
    max-width: 1100px; margin: 0 auto 2.5rem;
    padding: 0 1.5rem;
    box-shadow: 0 4px 24px rgba(0,0,0,.12);
    border-radius: 12px;
    overflow-x: visible;
    overflow-y: visible;
}
table { width:100%; border-collapse:collapse; }

thead th {
    position: sticky;
    position: -webkit-sticky;
    top: 88px;
    z-index: 10;
    background: var(--bg-deep);
    text-align: left;
    font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px;
    color: var(--text-lo); font-weight: 600;
    padding: 0.8rem 0.75rem;
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
    box-shadow: 0 1px 0 var(--border);
}
thead th:first-child { padding-left:1rem; }

tbody tr {
    border-bottom: 1px solid var(--border);
    transition: background .2s ease;
}
tbody tr:nth-child(odd)  { background: var(--bg-row); }
tbody tr:nth-child(even) { background: var(--bg-row-alt); }
tbody tr:hover           { background: rgba(27,77,62,.05); box-shadow: inset 0 0 0 1px rgba(27,77,62,.35); }
tbody tr.free-agent      { background: rgba(245,158,11,.12); box-shadow: inset 3px 0 0 var(--gold); }
tbody tr.free-agent:nth-child(even) { background: rgba(245,158,11,.08); box-shadow: inset 3px 0 0 var(--gold); }
tbody tr.free-agent:hover { background: rgba(245,158,11,.18); box-shadow: inset 3px 0 0 var(--gold), inset 0 0 0 1px rgba(245,158,11,.2); }

td { padding: 0.8rem 0.75rem; vertical-align: middle; }
td:first-child { padding-left:1rem; }

/* rank pill */
.rank-pill {
    display:inline-flex; align-items:center; justify-content:center;
    width:38px; height:38px; border-radius:8px;
    font-weight:700; font-size:.88rem;
}
.rank-tier1 { background: linear-gradient(135deg,#fef3c7,#fde68a); color:#1a1a1a; box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 2px 10px rgba(253,224,71,.5); }
.rank-gold   { background: linear-gradient(135deg,#f59e0b,#d97706); color:#1a1a1a; box-shadow: inset 0 1px 0 rgba(255,255,255,.15), 0 2px 8px rgba(245,158,11,.35); }
.rank-silver { background: linear-gradient(135deg,#cbd5e1,#94a3b8); color:#1a1a1a; box-shadow: inset 0 1px 0 rgba(255,255,255,.15), 0 2px 6px rgba(148,163,175,.3); }
.rank-bronze { background: linear-gradient(135deg,#f97316,#ea580c); color:#fff; box-shadow: inset 0 1px 0 rgba(255,255,255,.15), 0 2px 6px rgba(249,115,22,.35); }
.rank-tier4 { background: rgba(148,163,184,.25); color:#cbd5e1; box-shadow: inset 0 1px 0 rgba(255,255,255,.05); }
.rank-steel { background: var(--bg-card); color: var(--text-mid); border: 1px solid var(--border); box-shadow: inset 0 1px 0 rgba(255,255,255,.03); }

.empty-state-row td { padding: 2rem !important; border: none !important; }
.empty-state { text-align: center; color: var(--text-mid); font-size: 0.9rem; }
.empty-icon { display: block; font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.6; }

.tier-breaker { background: transparent !important; }
.tier-breaker td { padding: 0.35rem 0; border: none; vertical-align: middle; min-height: 1.5rem; }
tbody tr.tier-breaker:first-child td { padding-top: 2rem; }
.tier-breaker-line {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin: 0.5rem 0;
}
.tier-breaker-line::before,
.tier-breaker-line::after {
    content: '';
    display: block;
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--border) 15%, var(--border) 85%, transparent);
}
.tier-breaker-label {
    font-size: 0.68rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-lo);
    white-space: nowrap;
}

/* name col */
.p-name { font-weight:600; font-size:.9rem; color:var(--text-hi); }

/* pos badge — color by position */
.pos-badge {
    display:inline-block; padding:.2rem .55rem;
    border-radius:20px; font-size:.72rem; font-weight:600;
    background:rgba(27,77,62,.08); color:#1b4d3e;
}
.pos-sp { background:rgba(27,77,62,.13); color:#1b4d3e; }
.pos-c  { background:rgba(167,139,250,.2); color:#c4b5fd; }
.pos-1b { background:rgba(52,211,153,.2); color:#6ee7b7; }
.pos-2b { background:rgba(34,211,238,.2); color:#67e8f9; }
.pos-3b { background:rgba(251,146,60,.2); color:#fdba74; }
.pos-ss { background:rgba(251,191,36,.2); color:#fde047; }
.pos-of { background:rgba(244,114,182,.2); color:#f9a8d4; }
.pos-if { background:rgba(148,163,184,.2); color:#cbd5e1; }

.team-col { font-weight:600; font-size:.85rem; color:var(--text-mid); }
.num-col  { font-size:.85rem; color:var(--text-mid); }

/* borda score */
.borda-col { font-weight:700; font-size:.9rem; color:var(--accent-hi); }

/* SD / volatility */
.vol-wrap { display:flex; align-items:center; gap:.45rem; }
.vol-num  { font-size:.78rem; color:var(--text-mid); font-weight:500; }
.vol-badge {
    font-size:.65rem; font-weight:700; text-transform:uppercase;
    letter-spacing:.8px; padding:.15rem .42rem; border-radius:4px;
}
.vol-low     { background:rgba(52,211,153,.15); color:#34d399; }
.vol-mod     { background:rgba(251,191,36,.15); color:#fbbf24; }
.vol-high    { background:rgba(248,113,113,.15); color:#f87171; }
.vol-extreme { background:rgba(139,92,246,.15); color:#a78bfa; }
.vol-na      { background:rgba(100,116,139,.15); color:var(--text-lo); }

/* consensus dots */
.cons-dots { display:flex; gap:.3rem; }
.cons-dot  { width:8px; height:8px; border-radius:50%; background:var(--border); }
.cons-dot.on { background:var(--gold); box-shadow:0 0 4px rgba(245,158,11,.4); }



/* rank change arrows (up/down from previous run) */
.rank-change-wrap { display:inline-flex; align-items:center; gap:.35rem; }
.rank-arrow {
    display:inline-flex; align-items:center; gap:.15rem;
    font-size:1rem; font-weight:700; line-height:1;
}
.rank-arrow.rank-up { color:var(--green); }
.rank-arrow.rank-down { color:var(--red); }
.rank-change-num { font-size:.7em; font-weight:600; opacity:.95; }

/* single-source warning */
.warn-badge {
    display:inline-flex; align-items:center; gap:.25rem;
    font-size:.68rem; color:#fbbf24; font-weight:600;
    background:rgba(251,191,36,.1); padding:.12rem .4rem; border-radius:4px;
    margin-left:.4rem;
}

/* ── LOCKED SECTION ── */
.lock-row td { padding:0; border:none !important; }
.lock-box {
    background: linear-gradient(135deg,#f5faf8,#e8f3ed);
    border: 1px solid var(--border);
    border-radius:14px;
    padding:2.5rem 2rem;
    text-align:center;
    max-width:420px; margin:1.8rem auto;
}
.lock-icon { font-size:2.8rem; margin-bottom:.6rem; }
.lock-title { font-family:'Bebas Neue',cursive; font-size:1.55rem; letter-spacing:2px; margin-bottom:.35rem; }
.lock-desc { color:var(--text-mid); font-size:.82rem; line-height:1.5; margin-bottom:1.2rem; max-width:320px; margin-left:auto; margin-right:auto; }
.btn-unlock {
    background: linear-gradient(135deg,#1b4d3e,#2f7f63);
    color:#fff; border:none; padding:.6rem 1.6rem;
    border-radius:8px; font-size:.92rem; font-weight:700;
    cursor:pointer; transition: transform .15s, box-shadow .15s;
    box-shadow: 0 3px 16px rgba(28,92,71,.6);
}
.btn-unlock:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(28,92,71,.75); }
.btn-unlock:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--accent); }

.locked-ghost { opacity:.28; filter:blur(3.5px); pointer-events:none; user-select:none; }

/* ── METHODOLOGY ── */
.method-section {
    max-width: 1100px; margin: 0 auto 2.5rem;
    padding: 0 1.5rem;
}
.method-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 24px rgba(0,0,0,.15);
}
.method-card h3 { font-family:'Bebas Neue',cursive; font-size:1.3rem; letter-spacing:2px; margin-bottom:1rem; color:#fff; }
.method-grid { display:grid; grid-template-columns:1fr 1fr; gap:2rem; }
.method-item h4 { font-size:.82rem; color:var(--accent-hi); font-weight:600; margin-bottom:.35rem; text-transform:uppercase; letter-spacing:0.8px; }
.method-item p  { font-size:.8rem; color:var(--text-mid); line-height:1.65; }

/* ── FOOTER ── */
footer {
    border-top: 1px solid var(--border);
    padding: 2.5rem 1.5rem;
    text-align: center;
    color: var(--text-lo); font-size: 0.75rem;
    margin-top: 2rem;
}

/* ── ROSTER UPLOAD ── */
.btn-upload-roster {
    background: linear-gradient(135deg, #a855f7, #c084fc);
    color: #fff;
    border: 2px solid rgba(192, 132, 252, 0.8);
    border-radius: 8px;
    padding: 0.5rem 1.15rem;
    font-size: 0.85rem;
    font-weight: 700;
    cursor: pointer;
    font-family: inherit;
    letter-spacing: 0.4px;
    display: inline-flex;
    align-items: center;
    line-height: 1;
    box-shadow: 0 0 20px rgba(168, 85, 247, 0.6), 0 2px 8px rgba(0, 0, 0, 0.3);
    transition: transform .15s, box-shadow .15s;
}
.btn-upload-roster:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 0 28px rgba(168, 85, 247, 0.8), 0 4px 16px rgba(0, 0, 0, 0.3); }
.btn-upload-roster.loaded { background: var(--green); color: #0a0e1a; }
.btn-upload-roster.loaded:hover { box-shadow: 0 4px 14px rgba(52,211,153,.4); }
.fantasy-section {
    display: none;
    padding: 1rem 2rem;
    background: var(--bg-card);
    border-bottom: 1px solid var(--border);
}
.fantasy-section.open { display: block; }
.fantasy-desc { color: var(--text-mid); font-size: 0.82rem; margin-bottom: 0.75rem; line-height: 1.5; }
.fantasy-drop-zone {
    position: relative;
    border: 2px dashed var(--border);
    border-radius: 8px;
    transition: border-color .2s, background .2s;
}
.fantasy-drop-zone.drag-over { border-color: var(--gold); background: rgba(245,158,11,.08); }
.fantasy-drop-zone.success { border-color: var(--green); background: rgba(52,211,153,.06); }
.fantasy-drop-content {
    padding: 2rem 1rem;
    text-align: center;
    position: relative;
    min-height: 60px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}
.fantasy-drop-placeholder {
    color: var(--text-mid);
    font-size: 0.9rem;
}
.fantasy-drop-processing,
.fantasy-drop-success { display: none; }
.fantasy-drop-zone.processing .fantasy-drop-placeholder { display: none; }
.fantasy-drop-zone.processing .fantasy-drop-processing { display: flex; flex-direction: column; align-items: center; gap: 0.75rem; }
.fantasy-drop-zone.processing .fantasy-drop-success { display: none; }
.fantasy-drop-zone.success .fantasy-drop-placeholder,
.fantasy-drop-zone.success .fantasy-drop-processing { display: none; }
.fantasy-drop-zone.success .fantasy-drop-success { display: flex; flex-direction: column; align-items: center; gap: 0.5rem; }
.fantasy-drop-processing span { color: var(--text-mid); font-size: 0.9rem; }
.fantasy-checkmark {
    width: 48px; height: 48px;
    border-radius: 50%;
    background: rgba(52,211,153,.2);
    color: var(--green);
    font-size: 1.6rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: checkmark-pop 0.35s ease-out;
}
@keyframes checkmark-pop {
    0% { transform: scale(0); opacity: 0; }
    60% { transform: scale(1.15); }
    100% { transform: scale(1); opacity: 1; }
}
.fantasy-drop-success span:last-child { color: var(--green); font-weight: 600; font-size: 0.95rem; }
.fantasy-progress-wrap {
    display: none;
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--border);
    border-radius: 0 0 6px 6px;
    overflow: hidden;
}
.fantasy-drop-zone.processing .fantasy-progress-wrap { display: block; }
.fantasy-drop-zone.success .fantasy-progress-wrap { display: none; }
.fantasy-progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--accent), var(--accent-hi));
    transition: width 0.12s ease-out;
}

/* ── TOAST ── */
.fantasy-toast {
    position: fixed;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--bg-card);
    border: 1px solid var(--border);
    box-shadow: 0 8px 24px rgba(0,0,0,.4);
    border-radius: 10px;
    padding: 1rem 1.5rem;
    z-index: 9999;
    opacity: 0;
    transition: transform .3s, opacity .3s;
    max-width: 90%;
}
.fantasy-toast strong { color: var(--green); }
.fantasy-toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

.fa-legend {
    display: none;
    align-items: center;
    gap: 0.6rem;
    max-width: 1100px;
    margin: 0 auto 0.75rem;
    padding: 0 1.5rem;
    font-size: 0.78rem;
    color: var(--text-mid);
}
.fa-legend.show { display: flex; }
.fa-legend-bar {
    display: inline-block;
    width: 12px;
    height: 4px;
    border-radius: 2px;
    background: linear-gradient(90deg, var(--gold), #d97706);
    flex-shrink: 0;
}
.fa-legend-text { font-weight: 500; }

/* ── RESPONSIVE ── */
/* Tablet and below: allow horizontal scroll on body so table can extend and thead still sticks to viewport */
@media (max-width: 768px) {
    body { overflow-x: auto; }
}
@media (max-width: 768px) {
    header { padding: 0.75rem 1rem; min-height: 72px; }
    .header-logo-wrap img { height: 48px; max-width: 180px; }
    .logo-title { font-size: 2.25rem; letter-spacing: 3px; }
    .header-right { flex-wrap: wrap; }
    .btn-upload-roster { padding: 0.4rem 0.75rem; font-size: 0.72rem; white-space: nowrap; }
    .btn-pro { padding: 0.4rem 0.75rem; font-size: 0.72rem; }
    .hero { padding: 2rem 1rem 2rem; }
    .hero h1 { font-size: 2rem; }
    .hero-desc { font-size: 0.9rem; }
    .hero-pills { justify-content: center; gap: 0.6rem; }
    .hero-pill { font-size: 0.68rem; }
    .filter-bar { margin: 1rem auto 0.75rem; padding: 0 1rem; gap: 0.6rem; }
    .filter-group { min-width: 0; flex: 1 1 45%; }
    .filter-group[style*="flex:2"] { flex: 1 1 100%; }
    .table-wrap { padding: 0 1rem; margin-bottom: 1.5rem; width: 100%; max-width: 100%; overflow: visible; }
    .table-wrap::after { content: ''; display: block; height: 1px; }
    table { min-width: 680px; }
    thead th { position: sticky; position: -webkit-sticky; top: 88px; z-index: 10; background: var(--bg-deep); box-shadow: 0 1px 0 var(--border); }
    thead th, td { padding: 0.6rem 0.5rem; font-size: 0.8rem; }
    thead th:first-child, td:first-child { padding-left: 0.75rem; }
    .rank-pill { width: 34px; height: 34px; font-size: 0.8rem; }
    .p-name { font-size: 0.85rem; }
    .method-section { margin: 0 auto 1.5rem; padding: 0 1rem; }
    .method-card { padding: 1.5rem; }
    .method-grid { grid-template-columns: 1fr; gap: 1.25rem; }
    .method-item p { font-size: 0.78rem; }
    footer { padding: 1.5rem 1rem; font-size: 0.7rem; }
}

/* Mobile (small phones) */
@media (max-width: 480px) {
    header {
        flex-direction: column;
        padding: 1rem;
        gap: 0.75rem;
        min-height: auto;
    }
    .header-logo-wrap { justify-content: center; }
    .header-logo-wrap img { height: 44px; max-width: 160px; }
    .header-right { justify-content: center; gap: 0.5rem; flex-wrap: wrap; }
    .btn-upload-roster, .btn-pro {
        flex: 1;
        min-width: 100px;
        padding: 0.45rem 0.5rem;
        font-size: 0.68rem;
    }
    /* Sticky headers on mobile — top accounts for stacked header (logo + buttons) */
    thead th { position: sticky; position: -webkit-sticky; top: 120px; z-index: 10; background: var(--bg-deep); box-shadow: 0 1px 0 var(--border); }
    .logo-title { font-size: 1.55rem; letter-spacing: 1px; }
    .hero { padding: 1.5rem 0.75rem 1.5rem; }
    .hero h1 { font-size: 1.65rem; }
    .hero-desc { font-size: 0.85rem; }
    .hero-pills { flex-direction: column; align-items: center; gap: 0.5rem; }
    .hero-pill { font-size: 0.65rem; }
    .filter-bar { padding: 0 0.75rem; flex-direction: column; }
    .filter-group { flex: 1 1 auto !important; width: 100%; }
    .filter-group input, .filter-group select { padding: 0.55rem 0.75rem; min-height: 44px; font-size: 1rem; }
    .table-wrap { padding: 0 0.75rem; width: 100%; max-width: 100%; overflow: visible; }
    table { min-width: 640px; font-size: 0.78rem; }
    thead th, td { padding: 0.5rem 0.4rem; font-size: 0.75rem; }
    thead th:first-child, td:first-child { padding-left: 0.5rem; }
    .rank-pill { width: 30px; height: 30px; font-size: 0.75rem; }
    .pos-badge { padding: 0.15rem 0.4rem; font-size: 0.65rem; }
    .vol-badge { font-size: 0.6rem; padding: 0.12rem 0.35rem; }
    .cons-dot { width: 6px; height: 6px; }
    .tier-breaker td { padding: 0.4rem 0.5rem; }
    .tier-breaker-label { font-size: 0.62rem; }
    .method-card { padding: 1.25rem; }
    .method-card h3 { font-size: 1.15rem; }
    .method-item h4 { font-size: 0.75rem; }
    .method-item p { font-size: 0.75rem; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header>
    <a href="#" class="header-logo-wrap" aria-label="Rankle home">
        <img src="new_logo.png" alt="Rankle logo" />
    </a>
    <div class="header-right">
        <button type="button" class="btn-upload-roster" id="btnUploadRoster" onclick="document.getElementById('fantasySection').classList.toggle('open')">Upload Roster</button>
        <button class="btn-pro">⭐ Upgrade to Pro</button>
    </div>
</header>

<div class="fantasy-section" id="fantasySection">
    <p class="fantasy-desc">Drop your roster CSV or paste (Ctrl+V).</p>
    <div class="fantasy-drop-zone" id="fantasyDropZone" tabindex="0">
        <div class="fantasy-drop-content">
            <div class="fantasy-drop-placeholder">Drop CSV file or paste (Ctrl+V)</div>
            <div class="fantasy-drop-processing">
                <span>Processing…</span>
            </div>
            <div class="fantasy-drop-success">
                <div class="fantasy-checkmark">✓</div>
                <span>Roster imported!</span>
            </div>
        </div>
        <div class="fantasy-progress-wrap">
            <div class="fantasy-progress-bar" id="fantasyProgressBar"></div>
        </div>
    </div>
</div>

<!-- HERO -->
<div class="hero">
    <div class="hero-inner">
        <div class="hero-content">
            <div class="hero-label">MLB Prospect Rankings</div>
            <h1>Data-Driven <span class="highlight">Prospect Ranking</span></h1>
            <p class="hero-desc">The Rankle Score aggregates expert rankings through a robust algorithm—one consensus view that vastly simplifies and improves prospect ranking.</p>
            <div class="hero-pills">
                <span class="hero-pill">Z-score aggregation</span>
                <span class="hero-pill">Volatility scoring</span>
                <span class="hero-pill">Multi-source consensus</span>
            </div>
        </div>
        <div class="hero-preview">
            <div class="hero-preview-title">How to read the table</div>
            <div class="hero-legend">
                <div class="hero-legend-item">
                    <strong>Score</strong> — 0–100, higher = better consensus rank
                </div>
                <div class="hero-legend-item">
                    <strong>Consensus</strong> <div class="cons-dots"><div class="cons-dot on"></div><div class="cons-dot on"></div><div class="cons-dot on"></div><div class="cons-dot"></div><div class="cons-dot"></div><div class="cons-dot"></div></div>
                    <span class="hero-legend-note">Lit dots = sources that agreed on position</span>
                </div>
                <div class="hero-legend-item">
                    <strong>Volatility</strong>
                    <div class="hero-legend-vols">
                        <span class="vol-badge vol-low">Low</span>
                        <span class="vol-badge vol-mod">Mod</span>
                        <span class="vol-badge vol-high">High</span>
                        <span class="vol-badge vol-extreme">Ext</span>
                    </div>
                    <span class="hero-legend-note">Lower = sources agree; higher = more disagreement</span>
                </div>
                <div class="hero-legend-item">
                    <strong>Rank change</strong> <span class="rank-arrow rank-up">↑</span> <span class="rank-arrow rank-down">↓</span>
                    <span class="hero-legend-note">vs last time you viewed: ↑ moved up 3+ spots, ↓ moved down 3+</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- FILTERS -->
<div class="filter-bar">
    <div class="filter-group" style="flex:2;">
        <label>Search</label>
        <input type="text" id="searchInput" placeholder="Player name…">
    </div>
    <div class="filter-group">
        <label>Position</label>
        <select id="posFilter"></select>
    </div>
    <div class="filter-group">
        <label>Team</label>
        <select id="teamFilter"></select>
    </div>
    <div class="filter-group">
        <label>Volatility</label>
        <select id="volFilter">
            <option value="ALL">All</option>
            <option value="Low">Low</option>
            <option value="Moderate">Moderate</option>
            <option value="High">High</option>
            <option value="Extreme">Extreme</option>
        </select>
    </div>
</div>

<div class="fa-legend" id="faLegend" aria-hidden="true">
    <span class="fa-legend-bar"></span>
    <span class="fa-legend-text">Gold highlight = free agents (not on any roster)</span>
</div>

<!-- TABLE -->
<div class="table-wrap">
    <table>
        <thead>
            <tr>
                <th></th>
                <th>Player</th>
                <th>Pos</th>
                <th>Team</th>
                <th>Age</th>
                <th>ETA</th>
                <th>Score</th>
                <th>Volatility</th>
                <th>Consensus</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
</div>

<!-- METHODOLOGY -->
<div class="method-section">
    <div class="method-card">
        <h3>Our Methodology</h3>
        <div class="method-grid">
            <div class="method-item">
                <h4>Percentile Normalization</h4>
                <p>Raw ranks are converted to a 0–100 scale using the formula <strong style="color:var(--accent-hi);">score = 100 × (1 − (rank−1) / (N−1))</strong>. This means #1 on a Top-100 list scores identically to #1 on a Top-500 list. Being in the top 10% of any list produces the same normalized score regardless of list length.</p>
            </div>
            <div class="method-item">
                <h4>Rankle Score</h4>
                <p>Each source's rankings are statistically normalized to account for differences in list length and depth. Scores are then combined using a proprietary weighting method that rewards broad consensus across multiple experts.</p>
            </div>
            <div class="method-item">
                <h4>Volatility (Standard Deviation)</h4>
                <p>Sample standard deviation of <strong style="color:var(--accent-hi);">Z-scores</strong> across sources. <strong style="color:var(--green);">Low (&lt;0.3)</strong> = sources agree. <strong style="color:#fbbf24;">Moderate (0.3–0.7)</strong> = some disagreement. <strong style="color:var(--red);">High (0.7–0.85)</strong> = significant divergence. <strong style="color:#a78bfa;">Extreme (≥0.85)</strong> = major outlier or stark disagreement. Requires 2+ sources.</p>
            </div>
            <div class="method-item">
                <h4>Tiers (Percentile-Based Cliffs)</h4>
                <p>Tiers are computed using a non-parametric approach: we calculate score deltas between consecutive players, then identify tier breaks at gaps in the top 10% (90th percentile). A talent cliff occurs when the drop from one player to the next is among the largest in the list. We enforce a minimum spacing between breaks to avoid tiny clusters. If #1's lead over #2 meets the threshold, they receive Tier 1 (top tier).</p>
            </div>
        </div>
    </div>
</div>

<div class="fantasy-toast" id="fantasyToast"></div>

<script>
// ============================================================
// RANKING ENGINE  — unit-tested & verified before deployment
// ============================================================

// Normalize a single rank to 0–100 given the source list length.
// rank 1 → 100, rank N → 0, linear between.
// ============================================================
// Z-SCORE ENGINE — "Rankle Score"
// Each source's ranks are converted to Z-scores using the
// theoretical mean and stddev of a 1..N uniform distribution.
// Z-scores are averaged across sources, then scaled to 0-100.
// ============================================================

// Precompute mean + stddev for a uniform 1..N list
function sourceStats(listLength) {
    const mean = (listLength + 1) / 2;
    const sd   = Math.sqrt((listLength * listLength - 1) / 12);
    return { mean, sd };
}

// Given player meta and an array of { source, rank, listLength },
// return the full computed prospect object.
function computeProspect(meta, sourceRankings) {
    const n = sourceRankings.length;
    if (n === 0) return { ...meta, sourceCount: 0, consensusAgreement: 0, rankleScore: 0, sd: null, volatility: "N/A" };

    // Cap rank at listLength so bad data (e.g. rank 91 on a 50-item list) doesn't blow up volatility
    const capped = sourceRankings.map(s => ({ ...s, rank: Math.min(s.rank, s.listLength) }));

    // Convert each ranking to a Z-score
    const zScores  = capped.map(s => {
        const { mean, sd } = sourceStats(s.listLength);
        return -(s.rank - mean) / sd;   // negated: rank 1 = highest Z
    });
    const rawRanks = capped.map(s => s.rank);

    // Average Z across all sources
    const zAvg = zScores.reduce((a, b) => a + b, 0) / n;

    // Scale to 0-100 Rankle Score
    // Z range for a 100-item list is roughly -1.7 to +1.7
    // 50 + z*29.4 maps that to 0-100
    const rankleScore = Math.max(0, Math.min(100, 50 + zAvg * 29.4));

    // Volatility: stddev of Z-scores across sources
    let sd = null, volatility = "N/A";
    if (n >= 2) {
        const variance = zScores.reduce((sum, z) => sum + (z - zAvg) ** 2, 0) / (n - 1);
        sd = Math.sqrt(variance);
        volatility = sd < 0.3 ? "Low" : sd < 0.7 ? "Moderate" : sd < 0.85 ? "High" : "Extreme";
    }

    // Consensus (percentile band): count sources within ±10% of median percentile
    const CONSENSUS_BAND = 10;
    const percentiles = capped.map(s =>
        100 * (1 - (s.rank - 1) / (s.listLength - 1))
    );
    const sortedP = [...percentiles].sort((a, b) => a - b);
    const midP = Math.floor(sortedP.length / 2);
    const medianPercentile = sortedP.length % 2 !== 0
        ? sortedP[midP]
        : (sortedP[midP - 1] + sortedP[midP]) / 2;
    const consensusAgreement = percentiles.filter(p =>
        Math.abs(p - medianPercentile) <= CONSENSUS_BAND
    ).length;

    // Bayesian shrinkage: single-source players get pulled toward the mean (50).
    // More sources = more evidence = trust the score fully.
    // Formula: adjusted = (n * rawScore + k * 50) / (n + k), applied only when n === 1.
    // k=2 means a single-source score is weighted 1:2 against the prior mean.
    const K = 2;
    const penalizedScore = n === 1
        ? (rankleScore + K * 50) / (1 + K)
        : rankleScore;

    return { ...meta, sourceCount: n, consensusAgreement, rankleScore: Math.round(penalizedScore * 10) / 10, sd, volatility };
}

// ============================================================
// SOURCE DEFINITIONS
// Each source has its own list length — this is what makes
// normalization matter. Change these as you add real sources.
// ============================================================
const SOURCES = {
    pipeline:      { label: "MLB Pipeline",      listLength: 100 },
    ba:            { label: "Baseball America",  listLength: 100 },
    fangraphs:     { label: "FanGraphs",         listLength: 100 },
    br:            { label: "Bleacher Report",   listLength: 100 },
    espn:          { label: "ESPN",              listLength: 100 },
    justbaseball:  { label: "Just Baseball",     listLength: 100 },
    rotoprospects: { label: "RotoProspects",     listLength: 50 },
    prospect361:   { label: "Prospect361",       listLength: 100 },
    rotochamp:     { label: "RotoChamp",         listLength: 100 }
};

const RAW_DATA = [
    { name:"Konnor Griffin",        pos:"SS", team:"PIT", age:19, eta:"2026", ranks:{ pipeline:1, ba:1, fangraphs:null, br:2, espn:null, justbaseball:1, rotoprospects:1, prospect361:1, rotochamp:1 } },
    { name:"Kevin McGonigle",       pos:"SS", team:"DET", age:21, eta:"2026", ranks:{ pipeline:2, ba:2, fangraphs:null, br:1, espn:null, justbaseball:2, rotoprospects:3, prospect361:6, rotochamp:2 } },
    { name:"JJ Wetherholt",         pos:"SS", team:"STL", age:23, eta:"2026", ranks:{ pipeline:5, ba:3, fangraphs:null, br:7, espn:null, justbaseball:9, rotoprospects:5, prospect361:4, rotochamp:5 } },
    { name:"Jesus Made",            pos:"SS", team:"MIL", age:18, eta:"2026", ranks:{ pipeline:3, ba:4, fangraphs:null, br:3, espn:null, justbaseball:4, rotoprospects:2, prospect361:2, rotochamp:3 } },
    { name:"Walker Jenkins",        pos:"OF", team:"MIN", age:20, eta:"2026", ranks:{ pipeline:14, ba:5, fangraphs:null, br:21, espn:null, justbaseball:16, rotoprospects:4, prospect361:5, rotochamp:14 } },
    { name:"Max Clark",             pos:"OF", team:"DET", age:21, eta:"2026", ranks:{ pipeline:10, ba:6, fangraphs:null, br:17, espn:null, justbaseball:10, rotoprospects:11, prospect361:3, rotochamp:10 } },
    { name:"Colt Emerson",          pos:"SS", team:"SEA", age:20, eta:"2026", ranks:{ pipeline:9, ba:7, fangraphs:null, br:12, espn:null, justbaseball:5, rotoprospects:13, prospect361:17, rotochamp:9 } },
    { name:"Nolan McLean",          pos:"RHP", team:"NYM", age:24, eta:"2025", ranks:{ pipeline:6, ba:8, fangraphs:null, br:9, espn:null, justbaseball:3, rotoprospects:10, prospect361:23, rotochamp:6 } },
    { name:"Samuel Basallo",        pos:"C", team:"BAL", age:21, eta:"2025", ranks:{ pipeline:8, ba:9, fangraphs:null, br:8, espn:null, justbaseball:8, rotoprospects:8, prospect361:7, rotochamp:8 } },
    { name:"Trey Yesavage",         pos:"RHP", team:"TOR", age:22, eta:"2025", ranks:{ pipeline:12, ba:10, fangraphs:null, br:10, espn:null, justbaseball:6, rotoprospects:15, prospect361:28, rotochamp:12 } },
    { name:"Carter Jensen",         pos:"C", team:"KC", age:22, eta:"2025", ranks:{ pipeline:18, ba:11, fangraphs:null, br:64, espn:null, justbaseball:14, rotoprospects:25, prospect361:59, rotochamp:18 } },
    { name:"Leo De Vries",          pos:"SS", team:"ATH", age:19, eta:"2026", ranks:{ pipeline:4, ba:12, fangraphs:null, br:6, espn:null, justbaseball:7, rotoprospects:6, prospect361:12, rotochamp:4 } },
    { name:"Thomas White",          pos:"LHP", team:"MIA", age:21, eta:"2026", ranks:{ pipeline:17, ba:13, fangraphs:null, br:13, espn:null, justbaseball:18, rotoprospects:16, prospect361:27, rotochamp:17 } },
    { name:"Aidan Miller",          pos:"SS", team:"PHI", age:21, eta:"2026", ranks:{ pipeline:23, ba:14, fangraphs:null, br:36, espn:null, justbaseball:12, rotoprospects:12, prospect361:9, rotochamp:23 } },
    { name:"Bubba Chandler",        pos:"RHP", team:"PIT", age:23, eta:"2025", ranks:{ pipeline:11, ba:15, fangraphs:null, br:4, espn:null, justbaseball:11, rotoprospects:14, prospect361:10, rotochamp:11 } },
    { name:"Sebastian Walcott",     pos:"SS", team:"TEX", age:19, eta:"2026", ranks:{ pipeline:7, ba:16, fangraphs:null, br:5, espn:null, justbaseball:13, rotoprospects:7, prospect361:8, rotochamp:7 } },
    { name:"Payton Tolle",          pos:"LHP", team:"BOS", age:23, eta:"2025", ranks:{ pipeline:19, ba:17, fangraphs:null, br:32, espn:null, justbaseball:33, rotoprospects:33, prospect361:41, rotochamp:19 } },
    { name:"Bryce Eldridge",        pos:"1B", team:"SF", age:21, eta:"2025", ranks:{ pipeline:25, ba:18, fangraphs:null, br:11, espn:null, justbaseball:23, rotoprospects:19, prospect361:18, rotochamp:25 } },
    { name:"Carson Benge",          pos:"OF", team:"NYM", age:23, eta:"2026", ranks:{ pipeline:16, ba:19, fangraphs:null, br:29, espn:null, justbaseball:15, rotoprospects:17, prospect361:32, rotochamp:16 } },
    { name:"Eduardo Quintero",      pos:"OF", team:"LAD", age:20, eta:"2027", ranks:{ pipeline:30, ba:20, fangraphs:null, br:48, espn:null, justbaseball:44, rotoprospects:21, prospect361:20, rotochamp:30 } },
    { name:"Dylan Beavers",         pos:"OF", team:"BAL", age:24, eta:"2025", ranks:{ pipeline:69, ba:21, fangraphs:null, br:88, espn:null, justbaseball:63, rotoprospects:28, prospect361:null, rotochamp:69 } },
    { name:"Travis Bazzana",        pos:"2B", team:"CLE", age:23, eta:"2026", ranks:{ pipeline:20, ba:22, fangraphs:null, br:25, espn:null, justbaseball:48, rotoprospects:27, prospect361:73, rotochamp:20 } },
    { name:"Sal Stewart",           pos:"3B", team:"CIN", age:22, eta:"2025", ranks:{ pipeline:22, ba:23, fangraphs:null, br:31, espn:null, justbaseball:28, rotoprospects:9, prospect361:44, rotochamp:22 } },
    { name:"Josue De Paula",        pos:"OF", team:"LAD", age:20, eta:"2026", ranks:{ pipeline:15, ba:24, fangraphs:null, br:15, espn:null, justbaseball:20, rotoprospects:20, prospect361:11, rotochamp:15 } },
    { name:"Kade Anderson",         pos:"LHP", team:"SEA", age:21, eta:"2026", ranks:{ pipeline:21, ba:25, fangraphs:null, br:20, espn:null, justbaseball:31, rotoprospects:37, prospect361:21, rotochamp:21 } },
    { name:"Noah Schultz",          pos:"LHP", team:"CWS", age:22, eta:"2026", ranks:{ pipeline:49, ba:26, fangraphs:null, br:28, espn:null, justbaseball:58, rotoprospects:84, prospect361:74, rotochamp:49 } },
    { name:"Caleb Bonemer",         pos:"SS", team:"CWS", age:20, eta:"2027", ranks:{ pipeline:61, ba:27, fangraphs:null, br:82, espn:null, justbaseball:79, rotoprospects:32, prospect361:null, rotochamp:61 } },
    { name:"Edward Florentino",     pos:"OF", team:"PIT", age:19, eta:"2027", ranks:{ pipeline:50, ba:28, fangraphs:null, br:92, espn:null, justbaseball:36, rotoprospects:22, prospect361:96, rotochamp:50 } },
    { name:"Bryce Rainer",          pos:"SS", team:"DET", age:20, eta:"2027", ranks:{ pipeline:35, ba:29, fangraphs:null, br:26, espn:null, justbaseball:24, rotoprospects:23, prospect361:24, rotochamp:35 } },
    { name:"Josuar Gonzalez",       pos:"SS", team:"SF", age:18, eta:"2027", ranks:{ pipeline:44, ba:30, fangraphs:null, br:86, espn:null, justbaseball:null, rotoprospects:48, prospect361:69, rotochamp:44 } },
    { name:"Eli Willits",           pos:"SS", team:"WAS", age:18, eta:"2027", ranks:{ pipeline:13, ba:31, fangraphs:null, br:24, espn:null, justbaseball:25, rotoprospects:44, prospect361:66, rotochamp:13 } },
    { name:"Andrew Painter",        pos:"RHP", team:"PHI", age:22, eta:"2025", ranks:{ pipeline:28, ba:32, fangraphs:null, br:14, espn:null, justbaseball:21, rotoprospects:39, prospect361:13, rotochamp:28 } },
    { name:"Liam Doyle",            pos:"LHP", team:"STL", age:21, eta:"2026", ranks:{ pipeline:34, ba:33, fangraphs:null, br:37, espn:null, justbaseball:82, rotoprospects:70, prospect361:33, rotochamp:34 } },
    { name:"Chase DeLauter",        pos:"OF", team:"CLE", age:24, eta:"2025", ranks:{ pipeline:46, ba:34, fangraphs:null, br:65, espn:null, justbaseball:34, rotoprospects:72, prospect361:86, rotochamp:46 } },
    { name:"Rainiel Rodriguez",     pos:"C", team:"STL", age:19, eta:"2027", ranks:{ pipeline:74, ba:57, fangraphs:null, br:89, espn:null, justbaseball:46, rotoprospects:26, prospect361:83, rotochamp:74 } },
    { name:"Moises Ballesteros",    pos:"C", team:"CHC", age:22, eta:"2025", ranks:{ pipeline:55, ba:36, fangraphs:null, br:30, espn:null, justbaseball:60, rotoprospects:38, prospect361:25, rotochamp:55 } },
    { name:"Brody Hopkins",         pos:"RHP", team:"TB", age:24, eta:"2026", ranks:{ pipeline:85, ba:37, fangraphs:null, br:null, espn:null, justbaseball:75, rotoprospects:53, prospect361:null, rotochamp:85 } },
    { name:"Seth Hernandez",        pos:"RHP", team:"PIT", age:19, eta:"2027", ranks:{ pipeline:29, ba:38, fangraphs:null, br:23, espn:null, justbaseball:57, rotoprospects:61, prospect361:34, rotochamp:29 } },
    { name:"Jamie Arnold",          pos:"LHP", team:"ATH", age:19, eta:"2027", ranks:{ pipeline:41, ba:39, fangraphs:null, br:51, espn:null, justbaseball:null, rotoprospects:71, prospect361:null, rotochamp:41 } },
    { name:"Gage Jump",             pos:"LHP", team:"ATH", age:22, eta:"2026", ranks:{ pipeline:57, ba:40, fangraphs:null, br:45, espn:null, justbaseball:59, rotoprospects:null, prospect361:48, rotochamp:57 } },
    { name:"Robby Snelling",        pos:"LHP", team:"MIA", age:22, eta:"2026", ranks:{ pipeline:39, ba:41, fangraphs:null, br:71, espn:null, justbaseball:30, rotoprospects:34, prospect361:35, rotochamp:39 } },
    { name:"Aiva Arquette",         pos:"SS", team:"MIA", age:22, eta:"2027", ranks:{ pipeline:47, ba:42, fangraphs:null, br:33, espn:null, justbaseball:55, rotoprospects:68, prospect361:67, rotochamp:47 } },
    { name:"Owen Caissie",          pos:"OF", team:"CHC", age:23, eta:"2025", ranks:{ pipeline:42, ba:43, fangraphs:null, br:44, espn:null, justbaseball:41, rotoprospects:36, prospect361:null, rotochamp:42 } },
    { name:"Jonah Tong",            pos:"RHP", team:"NYM", age:22, eta:"2025", ranks:{ pipeline:48, ba:44, fangraphs:null, br:34, espn:null, justbaseball:37, rotoprospects:24, prospect361:26, rotochamp:48 } },
    { name:"Mike Sirota",           pos:"OF", team:"LAD", age:22, eta:"2026", ranks:{ pipeline:60, ba:45, fangraphs:null, br:47, espn:null, justbaseball:42, rotoprospects:45, prospect361:97, rotochamp:60 } },
    { name:"George Lombard",        pos:"SS", team:"NYY", age:20, eta:"2026", ranks:{ pipeline:32, ba:46, fangraphs:null, br:27, espn:null, justbaseball:22, rotoprospects:55, prospect361:37, rotochamp:32 } },
    { name:"Luis Pena",             pos:"SS", team:"MIL", age:19, eta:"2027", ranks:{ pipeline:26, ba:47, fangraphs:null, br:19, espn:null, justbaseball:17, rotoprospects:31, prospect361:15, rotochamp:26 } },
    { name:"Ryan Waldschmidt",      pos:"OF", team:"ARI", age:23, eta:"2026", ranks:{ pipeline:59, ba:48, fangraphs:null, br:74, espn:null, justbaseball:47, rotoprospects:29, prospect361:46, rotochamp:59 } },
    { name:"Franklin Arias",        pos:"SS", team:"BOS", age:20, eta:"2027", ranks:{ pipeline:31, ba:49, fangraphs:null, br:35, espn:null, justbaseball:40, rotoprospects:75, prospect361:14, rotochamp:31 } },
    { name:"Cooper Pratt",          pos:"SS", team:"MIL", age:21, eta:"2026", ranks:{ pipeline:64, ba:50, fangraphs:null, br:61, espn:null, justbaseball:71, rotoprospects:65, prospect361:58, rotochamp:64 } },
    { name:"Tyler Bremner",         pos:"RHP", team:"LAA", age:20, eta:"2027", ranks:{ pipeline:81, ba:51, fangraphs:null, br:73, espn:null, justbaseball:null, rotoprospects:89, prospect361:null, rotochamp:81 } },
    { name:"Connelly Early",        pos:"LHP", team:"BOS", age:23, eta:"2025", ranks:{ pipeline:56, ba:52, fangraphs:null, br:null, espn:null, justbaseball:29, rotoprospects:35, prospect361:55, rotochamp:56 } },
    { name:"Cam Caminiti",          pos:"LHP", team:"ATL", age:19, eta:"2027", ranks:{ pipeline:68, ba:53, fangraphs:null, br:87, espn:null, justbaseball:81, rotoprospects:86, prospect361:null, rotochamp:68 } },
    { name:"Joshua Baez",           pos:"OF", team:"STL", age:23, eta:"2026", ranks:{ pipeline:87, ba:54, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:18, prospect361:61, rotochamp:87 } },
    { name:"Joe Mack",              pos:"C", team:"MIA", age:23, eta:"2026", ranks:{ pipeline:62, ba:55, fangraphs:null, br:59, espn:null, justbaseball:26, rotoprospects:97, prospect361:null, rotochamp:62 } },
    { name:"Ralphy Velazquez",      pos:"1B", team:"CLE", age:20, eta:"2027", ranks:{ pipeline:89, ba:56, fangraphs:null, br:null, espn:null, justbaseball:91, rotoprospects:null, prospect361:null, rotochamp:89 } },
    { name:"Lazaro Montes",         pos:"OF", team:"SEA", age:21, eta:"2027", ranks:{ pipeline:43, ba:58, fangraphs:null, br:22, espn:null, justbaseball:61, rotoprospects:50, prospect361:45, rotochamp:43 } },
    { name:"Ryan Sloan",            pos:"RHP", team:"SEA", age:20, eta:"2027", ranks:{ pipeline:33, ba:60, fangraphs:null, br:80, espn:null, justbaseball:32, rotoprospects:40, prospect361:52, rotochamp:33 } },
    { name:"Dax Kilby",             pos:"SS", team:"NYY", age:19, eta:"2027", ranks:{ pipeline:94, ba:61, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:56, prospect361:null, rotochamp:94 } },
    { name:"Arjun Nimmala",         pos:"SS", team:"TOR", age:20, eta:"2027", ranks:{ pipeline:77, ba:62, fangraphs:null, br:57, espn:null, justbaseball:85, rotoprospects:66, prospect361:39, rotochamp:77 } },
    { name:"Zyhir Hope",            pos:"OF", team:"LAD", age:21, eta:"2027", ranks:{ pipeline:27, ba:63, fangraphs:null, br:18, espn:null, justbaseball:19, rotoprospects:58, prospect361:16, rotochamp:27 } },
    { name:"Theo Gillen",           pos:"OF", team:"TB", age:20, eta:"2027", ranks:{ pipeline:76, ba:64, fangraphs:null, br:49, espn:null, justbaseball:89, rotoprospects:null, prospect361:40, rotochamp:76 } },
    { name:"Caden Scarborough",     pos:"RHP", team:"TEX", age:20, eta:"2027", ranks:{ pipeline:null, ba:65, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:95, prospect361:null, rotochamp:null } },
    { name:"JoJo Parker",           pos:"SS", team:"TOR", age:19, eta:"2027", ranks:{ pipeline:45, ba:66, fangraphs:null, br:53, espn:null, justbaseball:68, rotoprospects:69, prospect361:51, rotochamp:45 } },
    { name:"Angel Genao",           pos:"SS", team:"CLE", age:21, eta:"2026", ranks:{ pipeline:66, ba:67, fangraphs:null, br:41, espn:null, justbaseball:56, rotoprospects:76, prospect361:57, rotochamp:66 } },
    { name:"Jarlin Susana",         pos:"RHP", team:"WAS", age:21, eta:"2026", ranks:{ pipeline:80, ba:68, fangraphs:null, br:66, espn:null, justbaseball:35, rotoprospects:67, prospect361:null, rotochamp:80 } },
    { name:"Kyson Witherspoon",     pos:"RHP", team:"BOS", age:19, eta:"2027", ranks:{ pipeline:84, ba:69, fangraphs:null, br:55, espn:null, justbaseball:null, rotoprospects:88, prospect361:75, rotochamp:84 } },
    { name:"Jacob Melton",          pos:"OF", team:"TB", age:25, eta:"2027", ranks:{ pipeline:null, ba:70, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:79, prospect361:89, rotochamp:null } },
    { name:"Jett Williams",         pos:"SS", team:"NYM", age:22, eta:"2026", ranks:{ pipeline:63, ba:85, fangraphs:null, br:39, espn:null, justbaseball:69, rotoprospects:30, prospect361:50, rotochamp:63 } },
    { name:"Trey Gibson",           pos:"RHP", team:"BAL", age:23, eta:"2026", ranks:{ pipeline:null, ba:72, fangraphs:null, br:null, espn:null, justbaseball:96, rotoprospects:96, prospect361:null, rotochamp:null } },
    { name:"Braden Montgomery",     pos:"OF", team:"CWS", age:22, eta:"2026", ranks:{ pipeline:36, ba:73, fangraphs:null, br:54, espn:null, justbaseball:73, rotoprospects:42, prospect361:49, rotochamp:36 } },
    { name:"Kaelen Culpepper",      pos:"SS", team:"MIN", age:23, eta:"2026", ranks:{ pipeline:52, ba:74, fangraphs:null, br:81, espn:null, justbaseball:92, rotoprospects:49, prospect361:30, rotochamp:52 } },
    { name:"Justin Crawford",       pos:"OF", team:"PHI", age:22, eta:"2026", ranks:{ pipeline:53, ba:75, fangraphs:null, br:40, espn:null, justbaseball:90, rotoprospects:78, prospect361:38, rotochamp:53 } },
    { name:"Josue Briceno",         pos:"C", team:"DET", age:21, eta:"2026", ranks:{ pipeline:40, ba:76, fangraphs:null, br:38, espn:null, justbaseball:38, rotoprospects:54, prospect361:22, rotochamp:40 } },
    { name:"Alfredo Duno",          pos:"C", team:"CIN", age:20, eta:"2027", ranks:{ pipeline:38, ba:77, fangraphs:null, br:46, espn:null, justbaseball:45, rotoprospects:47, prospect361:56, rotochamp:38 } },
    { name:"Jaxon Wiggins",         pos:"RHP", team:"CHC", age:24, eta:"2026", ranks:{ pipeline:58, ba:78, fangraphs:null, br:94, espn:null, justbaseball:72, rotoprospects:80, prospect361:null, rotochamp:58 } },
    { name:"Rhett Lowder",          pos:"RHP", team:"CIN", age:23, eta:"2024", ranks:{ pipeline:86, ba:79, fangraphs:null, br:69, espn:null, justbaseball:80, rotoprospects:null, prospect361:null, rotochamp:86 } },
    { name:"Ethan Holliday",        pos:"SS", team:"COL", age:18, eta:"2027", ranks:{ pipeline:24, ba:80, fangraphs:null, br:16, espn:null, justbaseball:39, rotoprospects:57, prospect361:19, rotochamp:24 } },
    { name:"Brandon Sproat",        pos:"RHP", team:"NYM", age:25, eta:"2025", ranks:{ pipeline:100, ba:81, fangraphs:null, br:90, espn:null, justbaseball:87, rotoprospects:62, prospect361:43, rotochamp:100 } },
    { name:"Kendry Chourio",        pos:"RHP", team:"KC", age:19, eta:"2027", ranks:{ pipeline:null, ba:82, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:98, prospect361:null, rotochamp:null } },
    { name:"A.J. Ewing",            pos:"OF", team:"NYM", age:21, eta:"2027", ranks:{ pipeline:97, ba:83, fangraphs:null, br:null, espn:null, justbaseball:65, rotoprospects:83, prospect361:71, rotochamp:97 } },
    { name:"JR Ritchie",            pos:"RHP", team:"ATL", age:22, eta:"2026", ranks:{ pipeline:90, ba:84, fangraphs:null, br:98, espn:null, justbaseball:94, rotoprospects:91, prospect361:84, rotochamp:90 } },
    { name:"Nate George",           pos:"OF", team:"BAL", age:19, eta:"2027", ranks:{ pipeline:93, ba:86, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:74, prospect361:null, rotochamp:93 } },
    { name:"Bo Davidson",           pos:"OF", team:"SF", age:23, eta:"2027", ranks:{ pipeline:null, ba:87, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:82, prospect361:null, rotochamp:null } },
    { name:"Parker Messick",        pos:"LHP", team:"CLE", age:24, eta:"2026", ranks:{ pipeline:95, ba:88, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:95 } },
    { name:"Braylon Doughty",       pos:"RHP", team:"CLE", age:20, eta:"2027", ranks:{ pipeline:null, ba:89, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Ethan Salas",           pos:"C", team:"SD", age:19, eta:"2027", ranks:{ pipeline:null, ba:90, fangraphs:null, br:70, espn:null, justbaseball:83, rotoprospects:null, prospect361:79, rotochamp:null } },
    { name:"Hagen Smith",           pos:"LHP", team:"CWS", age:21, eta:"2027", ranks:{ pipeline:72, ba:91, fangraphs:null, br:75, espn:null, justbaseball:null, rotoprospects:85, prospect361:null, rotochamp:72 } },
    { name:"Billy Carlson",         pos:"SS", team:"CWS", age:19, eta:"2027", ranks:{ pipeline:73, ba:92, fangraphs:null, br:72, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:73 } },
    { name:"Carlos Lagrange",       pos:"RHP", team:"NYY", age:22, eta:"2026", ranks:{ pipeline:79, ba:93, fangraphs:null, br:null, espn:null, justbaseball:95, rotoprospects:81, prospect361:100, rotochamp:79 } },
    { name:"Connor Prielipp",       pos:"LHP", team:"MIN", age:25, eta:"2027", ranks:{ pipeline:null, ba:94, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Luis De Leon",          pos:"LHP", team:"BAL", age:22, eta:"2027", ranks:{ pipeline:null, ba:95, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:100, prospect361:null, rotochamp:null } },
    { name:"Logan Henderson",       pos:"RHP", team:"MIL", age:23, eta:"2025", ranks:{ pipeline:null, ba:96, fangraphs:null, br:83, espn:null, justbaseball:100, rotoprospects:90, prospect361:null, rotochamp:null } },
    { name:"Kayson Cunningham",     pos:"SS", team:"ARI", age:19, eta:"2027", ranks:{ pipeline:null, ba:97, fangraphs:null, br:97, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Jhonny Level",          pos:"SS", team:"SF", age:19, eta:"2027", ranks:{ pipeline:null, ba:98, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:81, rotochamp:null } },
    { name:"Harry Ford",            pos:"C", team:"SEA", age:22, eta:"2025", ranks:{ pipeline:71, ba:99, fangraphs:null, br:62, espn:null, justbaseball:64, rotoprospects:null, prospect361:42, rotochamp:71 } },
    { name:"Tanner McDougal",       pos:"RHP", team:"CWS", age:22, eta:"2027", ranks:{ pipeline:null, ba:100, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Travis Sykora",         pos:"RHP", team:"WAS", age:21, eta:"2027", ranks:{ pipeline:54, ba:null, fangraphs:null, br:63, espn:null, justbaseball:78, rotoprospects:null, prospect361:64, rotochamp:54 } },
    { name:"Eduardo Tait",          pos:"C", team:"MIN", age:19, eta:"2027", ranks:{ pipeline:65, ba:null, fangraphs:null, br:60, espn:null, justbaseball:67, rotoprospects:null, prospect361:76, rotochamp:65 } },
    { name:"Michael Arroyo",        pos:"2B", team:"SEA", age:21, eta:"2026", ranks:{ pipeline:67, ba:null, fangraphs:null, br:56, espn:null, justbaseball:84, rotoprospects:87, prospect361:82, rotochamp:67 } },
    { name:"Charlie Condon",        pos:"1B", team:"COL", age:22, eta:"2026", ranks:{ pipeline:70, ba:null, fangraphs:null, br:67, espn:null, justbaseball:62, rotoprospects:null, prospect361:60, rotochamp:70 } },
    { name:"Blake Mitchell",        pos:"C", team:"KC", age:20, eta:"2027", ranks:{ pipeline:75, ba:null, fangraphs:null, br:76, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:75 } },
    { name:"Jonny Farmelo",         pos:"OF", team:"SEA", age:21, eta:"2026", ranks:{ pipeline:78, ba:null, fangraphs:null, br:50, espn:null, justbaseball:52, rotoprospects:93, prospect361:92, rotochamp:78 } },
    { name:"Steele Hall",           pos:"SS", team:"CIN", age:19, eta:"2027", ranks:{ pipeline:83, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:60, prospect361:null, rotochamp:83 } },
    { name:"Kruz Schoolcraft",      pos:"LHP", team:"SD", age:19, eta:"2027", ranks:{ pipeline:88, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:88 } },
    { name:"Jurrangelo Cijntje",    pos:"RHP", team:"STL", age:21, eta:"2027", ranks:{ pipeline:91, ba:null, fangraphs:null, br:93, espn:null, justbaseball:null, rotoprospects:null, prospect361:70, rotochamp:91 } },
    { name:"Emil Morales",          pos:"RHP", team:"ATH", age:23, eta:"2025", ranks:{ pipeline:92, ba:null, fangraphs:null, br:null, espn:null, justbaseball:27, rotoprospects:null, prospect361:null, rotochamp:92 } },
    { name:"Hunter Barco",          pos:"LHP", team:"PIT", age:24, eta:"2026", ranks:{ pipeline:96, ba:null, fangraphs:null, br:77, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:96 } },
    { name:"Leonardo Bernal",       pos:"C", team:"STL", age:20, eta:"2027", ranks:{ pipeline:98, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:98 } },
    { name:"Cooper Ingle",          pos:"C", team:"CLE", age:23, eta:"2026", ranks:{ pipeline:99, ba:null, fangraphs:null, br:null, espn:null, justbaseball:70, rotoprospects:null, prospect361:99, rotochamp:99 } },
    { name:"Tatsuya Imai",          pos:"SP", team:"HOU", age:28, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:41, prospect361:31, rotochamp:null } },
    { name:"Munetaka Murakami",     pos:"1B", team:"CHW", age:26, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:43, prospect361:null, rotochamp:null } },
    { name:"Ralphy Velasquez",      pos:"C", team:"CLE", age:21, eta:"2026", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:46, prospect361:null, rotochamp:null } },
    { name:"Spencer Jones",         pos:"OF", team:"NYY", age:24, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:95, espn:null, justbaseball:null, rotoprospects:59, prospect361:85, rotochamp:null } },
    { name:"Ryan Clifford",         pos:"1B", team:"NYM", age:22, eta:"2026", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:99, rotoprospects:63, prospect361:null, rotochamp:null } },
    { name:"Andrew Fischer",        pos:"3B", team:"MIL", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:73, prospect361:null, rotochamp:null } },
    { name:"Brice Matthews",        pos:"SS", team:"HOU", age:23, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:96, espn:null, justbaseball:null, rotoprospects:77, prospect361:null, rotochamp:null } },
    { name:"Jacob Reimer",          pos:"3B", team:"NYM", age:21, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:93, rotoprospects:92, prospect361:null, rotochamp:null } },
    { name:"Kazuma Okamoto",        pos:"1B", team:"TOR", age:29, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:94, prospect361:null, rotochamp:null } },
    { name:"Zach Cole",             pos:"OF", team:"HOU", age:25, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:99, prospect361:null, rotochamp:null } },
    { name:"Felnin Celesten",       pos:"SS", team:"SEA", age:20, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:36, rotochamp:null } },
    { name:"Kazuma Okamota",        pos:"3B", team:"TOR", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:47, rotochamp:null } },
    { name:"Jeferson Quero",        pos:"C", team:"MIL", age:23, eta:"2025", ranks:{ pipeline:null, ba:null, fangraphs:null, br:68, espn:null, justbaseball:50, rotoprospects:null, prospect361:53, rotochamp:null } },
    { name:"Ike Irish",             pos:"C", team:"BAL", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:42, espn:null, justbaseball:null, rotoprospects:null, prospect361:54, rotochamp:null } },
    { name:"Elmer Rodriguez-Cruz",  pos:"RHP", team:"NYY", age:21, eta:"2027", ranks:{ pipeline:82, ba:59, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:52, prospect361:62, rotochamp:82 } },
    { name:"Slade Caldwell",        pos:"OF", team:"ARI", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:79, espn:null, justbaseball:88, rotoprospects:null, prospect361:63, rotochamp:null } },
    { name:"Termarr Johnson",       pos:"SS", team:"PIT", age:21, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:65, rotochamp:null } },
    { name:"Jhostynxon Garcia",     pos:"OF", team:"BOS", age:23, eta:"2025", ranks:{ pipeline:null, ba:null, fangraphs:null, br:84, espn:null, justbaseball:74, rotoprospects:null, prospect361:68, rotochamp:null } },
    { name:"Aroon Escobar",         pos:"3B", team:"PHI", age:21, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:72, rotochamp:null } },
    { name:"Jaden Hamm",            pos:"RHP", team:"DET", age:23, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:77, rotochamp:null } },
    { name:"Staryln Caba",          pos:"SS", team:"MIA", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:78, rotochamp:null } },
    { name:"Cole Carrigg",          pos:"OF", team:"COL", age:23, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:80, rotochamp:null } },
    { name:"River Ryan",            pos:"RHP", team:"LAD", age:27, eta:"2024", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:77, rotoprospects:null, prospect361:87, rotochamp:null } },
    { name:"Wehiwa Aloy",           pos:"SS", team:"BAL", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:88, rotochamp:null } },
    { name:"Tink Hence",            pos:"RHP", team:"STL", age:23, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:90, rotochamp:null } },
    { name:"Welbyn Francisca",      pos:"SS", team:"CLE", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:91, rotochamp:null } },
    { name:"Tommy Troy",            pos:"3B", team:"ARI", age:24, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:93, rotochamp:null } },
    { name:"Ricky Tiedemann",       pos:"LHP", team:"TOR", age:23, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:94, rotochamp:null } },
    { name:"Marek Houston",         pos:"SS", team:"MIN", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:99, espn:null, justbaseball:null, rotoprospects:null, prospect361:95, rotochamp:null } },
    { name:"Xavier Isaac",          pos:"1B", team:"TB", age:22, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:null, rotoprospects:null, prospect361:98, rotochamp:null } },
    { name:"Thayron Liranzo", pos:"C", team:"DET", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:100, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Cam Collier",           pos:"1B", team:"CIN", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:85, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Jefferson Rojas",      pos:"SS", team:"CHC", age:19, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:78, espn:null, justbaseball:null, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Alex Freeland",        pos:"SS", team:"LAD", age:24, eta:"2025", ranks:{ pipeline:null, ba:null, fangraphs:null, br:58, espn:null, justbaseball:51, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Carson Williams",      pos:"SS", team:"TB", age:22, eta:"2025", ranks:{ pipeline:null, ba:null, fangraphs:null, br:52, espn:null, justbaseball:49, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Emmanuel Rodríguez",   pos:"OF", team:"MIN", age:22, eta:"2026", ranks:{ pipeline:null, ba:null, fangraphs:null, br:43, espn:null, justbaseball:53, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Luis Perales",          pos:"RHP", team:"BOS", age:22, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:43, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Jordan Lawlar",         pos:"SS", team:"ARI", age:23, eta:"2025", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:54, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Josuar De Jesus",       pos:"SS", team:"SF", age:18, eta:"2028", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:66, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Demetrio Crisantes",    pos:"2B", team:"ARI", age:21, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:76, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"George Klassen",        pos:"RHP", team:"LAA", age:24, eta:"2026", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:86, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Khal Stephen",          pos:"RHP", team:"CLE", age:23, eta:"2026", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:97, rotoprospects:null, prospect361:null, rotochamp:null } },
    { name:"Charlee Soto",          pos:"RHP", team:"MIN", age:20, eta:"2027", ranks:{ pipeline:null, ba:null, fangraphs:null, br:null, espn:null, justbaseball:98, rotoprospects:null, prospect361:null, rotochamp:null } }
];

const LAST_UPDATED = {
    rotoprospects: "2026-02-09T19:18:55.043Z",
    rotochamp: "2026-02-03T19:55:01.549Z",
    pipeline: "2026-02-09T18:48:33.121Z",
    ba: "2026-02-09T19:07:33.616Z",
    br: "2026-02-09T19:12:03.888Z",
    justbaseball: "2026-02-10T03:32:45.039Z"
};

// ============================================================
// BUILD + SORT
// ============================================================
function buildProspects() {
    return RAW_DATA.map(row => {
        const sourceRankings = [];
        for (const [key, val] of Object.entries(row.ranks)) {
            if (val !== null && SOURCES[key]) {
                sourceRankings.push({ source: key, rank: val, listLength: SOURCES[key].listLength });
            }
        }
        return computeProspect(
            { name: row.name, pos: row.pos, team: row.team, age: row.age, eta: row.eta },
            sourceRankings
        );
    })
    .filter(p => p.sourceCount > 0)                    // exclude prospects with no ranks (would show 0.0)
    .sort((a, b) => b.rankleScore - a.rankleScore)     // primary: Rankle Score descending
    .map((p, i) => ({ ...p, displayRank: i + 1 }));   // assign final display rank
}

// ============================================================
// TIER BOUNDARIES — percentile-based talent cliffs
// Tier breaks occur at gaps in the top P% of all score drops.
// Non-parametric, interpretable, tunable.
// ============================================================
const TIER_PERCENTILE = 90;   // 90th percentile = largest 10% of gaps trigger breaks
const TIER_MIN_SPACING = 3;   // minimum players between breaks (avoid tiny clusters)

function percentile(arr, p) {
    if (arr.length === 0) return 0;
    const sorted = [...arr].sort((a, b) => a - b);
    const idx = (p / 100) * (sorted.length - 1);
    const lo = Math.floor(idx), hi = Math.ceil(idx);
    return lo === hi ? sorted[lo] : sorted[lo] + (idx - lo) * (sorted[hi] - sorted[lo]);
}

function calculateTalentCliffs(prospects) {
    const n = prospects.length;
    if (n === 0) return [];
    if (n === 1) return [{ ...prospects[0], tier: 1 }];

    const gaps = [];
    for (let i = 0; i < n - 1; i++) {
        gaps.push(prospects[i].rankleScore - prospects[i + 1].rankleScore);
    }

    const threshold = percentile(gaps, TIER_PERCENTILE);
    const candidates = gaps
        .map((g, i) => (g >= threshold ? { i, g } : null))
        .filter(Boolean)
        .sort((a, b) => b.g - a.g);  // largest gaps first

    // Enforce minimum spacing: when gaps are close, keep the larger one
    const breakIndices = [];
    for (const { i } of candidates) {
        const tooClose = breakIndices.some(b => Math.abs(i - b) < TIER_MIN_SPACING);
        if (!tooClose) breakIndices.push(i);
    }
    breakIndices.sort((a, b) => a - b);

    // Tier 1 = top (when #1 is far ahead); tier 2, 3, ... below
    const topIsSolo = gaps[0] >= threshold;

    return prospects.map((p, i) => {
        if (topIsSolo && i === 0) return { ...p, tier: 1 };
        let tier = 1;
        for (const b of breakIndices) {
            if (i <= b) break;
            tier++;
        }
        return { ...p, tier };
    });
}

// Load previous display ranks (from last page view) for change arrows
let PREV_RANK_MAP = {};
try { PREV_RANK_MAP = JSON.parse(localStorage.getItem('rankle-prev-display-rank') || '{}'); } catch(e) {}

const ALL_PROSPECTS = (() => {
    const built = buildProspects();
    // Include all prospects (single- and multi-source) so every position appears on the master list
    const withDisplayRank = built.map((p, i) => ({ ...p, displayRank: i + 1 }));
    return calculateTalentCliffs(withDisplayRank);
})();

// Persist current display ranks for next visit (so we can show up/down arrows)
try {
    const nextPrev = {};
    ALL_PROSPECTS.forEach(p => { nextPrev[p.name] = p.displayRank; });
    localStorage.setItem('rankle-prev-display-rank', JSON.stringify(nextPrev));
} catch(e) {}

const RANK_CHANGE_THRESHOLD = 1;  // min spots moved to show arrow (1 = any change)
const FREE_LIMIT    = 999;  // ← no paywall during development

// ============================================================
// ROSTER UPLOAD (sessionStorage)
// ============================================================
const FANTASY_STORAGE = 'rankle-fantasy-csv';

function looksLikeMlbTeam(s) {
    const v = (s || '').trim();
    if (!v || v.length > 6) return false;
    return /^[A-Z]{2,3}$/i.test(v) || /^(tb|sd|sf|la|nyy|nym|chw|chc|kc|stl|ari|atl|bal|bos|cle|col|det|hou|mil|min|oak|sea|tex|tor|was|wsh|mia|phi|cws|cin)$/i.test(v);
}

function looksLikeId(s) {
    const v = (s || '').trim();
    if (!v || v.length < 8) return false;
    return /^[0-9a-f]{8,}$/i.test(v) || (/^[a-z0-9]{10,}$/i.test(v) && !/[aeiou]/i.test(v));
}

function looksLikePercentOrStat(s) {
    const v = (s || '').trim();
    if (!v) return false;
    if (/%$/.test(v)) return true;
    const n = parseFloat(v.replace(/%/g, ''));
    return !isNaN(n) && v.replace(/[\d.\s%]/g, '').length === 0;
}

function parseCsvLine(line, sep) {
    if (sep === '\t') return line.split(sep).map(c => c.replace(/^"|"$/g, '').trim());
    const out = [];
    let cur = '', inQuote = false;
    for (let i = 0; i < line.length; i++) {
        const ch = line[i];
        if (ch === '"') inQuote = !inQuote;
        else if (ch === ',' && !inQuote) {
            out.push(cur.replace(/^"|"$/g, '').trim());
            cur = '';
        } else cur += ch;
    }
    out.push(cur.replace(/^"|"$/g, '').trim());
    return out;
}

function parseFantasyCsv(text) {
    const lines = text.trim().split(/[\r\n]+/).filter(l => l.trim());
    if (lines.length < 2) return {};
    const sep = lines[0].includes('\t') ? '\t' : ',';
    const cols = parseCsvLine(lines[0], sep).map(c => c.toLowerCase());
    const parseRow = i => parseCsvLine(lines[i], sep);

    let playerIdx = cols.findIndex(c => /^player$|^name$|^hitter$|^pitcher$/.test(c));
    if (playerIdx === -1) playerIdx = cols.findIndex(c => c.includes('player') || c.includes('name'));
    if (playerIdx === -1) playerIdx = 0;

    const statHeaders = /^(pos|position|slot|elig|ab|hr|rbi|avg|ip|k|whip|era|sv|id|player.?id|owned|owned.?%|own.?%|ownership|%|pct)$/i;
    const ownerHeaders = /^owner$|^fantasy|^fantasy.?team$|^team.?owner$|^manager$|^owned.?by$|^drafted.?by$|^franchise$|^gm$/;

    let ownerIdx = -1;
    const statusIdx = cols.findIndex(c => /^status$/i.test(c));
    if (statusIdx >= 0) {
        const statusVals = [];
        for (let r = 1; r < Math.min(lines.length, 51); r++) {
            const v = (parseRow(r)[statusIdx] || '').trim();
            if (v) statusVals.push(v);
        }
        const hasFa = statusVals.some(v => /^fa$/i.test(v));
        const valid = statusVals.filter(v => !looksLikePercentOrStat(v)).length;
        if (hasFa || valid >= statusVals.length * 0.8) ownerIdx = statusIdx;
    }
    let bestScore = -1;

    for (let c = 0; c < cols.length && ownerIdx === -1; c++) {
        if (c === playerIdx || statHeaders.test(cols[c])) continue;
        const vals = [];
        for (let r = 1; r < Math.min(lines.length, 101); r++) {
            const v = (parseRow(r)[c] || '').trim();
            if (v) vals.push(v);
        }
        if (vals.length < 3) continue;

        const mlbLike = vals.filter(v => looksLikeMlbTeam(v)).length;
        const idLike = vals.filter(v => looksLikeId(v)).length;
        const percentLike = vals.filter(v => looksLikePercentOrStat(v)).length;
        const validVals = vals.filter(v => !looksLikeMlbTeam(v) && !looksLikeId(v) && !looksLikePercentOrStat(v));
        const unique = new Set(validVals).size;

        if (mlbLike >= vals.length * 0.6) continue;
        if (idLike >= vals.length * 0.4) continue;
        if (percentLike >= vals.length * 0.5) continue;
        if (unique < 2 || unique > vals.length * 0.95) continue;

        const leagueSized = unique >= 3 && unique <= 24;
        const headerMatch = ownerHeaders.test(cols[c]);
        const teamHeaderOk = /^team$/.test(cols[c]) && mlbLike < vals.length * 0.3;

        let score = validVals.length * 2 + unique;
        if (headerMatch) score += 500;
        else if (teamHeaderOk) score += 50;
        if (leagueSized) score += 100;

        if (score > bestScore) {
            bestScore = score;
            ownerIdx = c;
        }
    }

    if (ownerIdx === -1) {
        const explicit = cols.findIndex(c => ownerHeaders.test(c) && !statHeaders.test(c));
        if (explicit >= 0) {
            const exVals = [];
            for (let r = 1; r < Math.min(lines.length, 21); r++) {
                const v = (parseRow(r)[explicit] || '').trim();
                if (v) exVals.push(v);
            }
            if (exVals.filter(v => looksLikePercentOrStat(v)).length < exVals.length * 0.5) ownerIdx = explicit;
        }
        if (ownerIdx === -1) ownerIdx = cols.length > 2 ? cols.length - 1 : 1;
    }

    const map = {};
    for (let i = 1; i < lines.length; i++) {
        const cells = parseRow(i);
        const name = (cells[playerIdx] || '').trim();
        const owner = (cells[ownerIdx] || '').trim();
        if (!name) continue;
        const ownerUpper = owner.toUpperCase();
        if (ownerUpper === 'FA' || /^fa$/i.test(owner)) continue;
        if (ownerIdx !== statusIdx && (looksLikeMlbTeam(owner) || looksLikePercentOrStat(owner))) continue;
        if (!owner || owner.length < 1) continue;
        const n = normalizeName(name);
        map[n] = owner;
    }
    return map;
}

function normalizeName(s) {
    return s.replace(/\s+/g, ' ').trim().toLowerCase();
}

function nameForMatch(s) {
    return normalizeName(s).replace(/[.\-']/g, '').replace(/\s+/g, ' ');
}

function compressedName(s) {
    return nameForMatch(s).replace(/\s+/g, '');
}

function getOwnerForProspect(prospectName) {
    if (!prospectName || Object.keys(ownershipMap).length === 0) return null;
    const n = normalizeName(prospectName);
    const nMatch = nameForMatch(prospectName);
    const nComp = compressedName(prospectName);
    if (ownershipMap[n]) return ownershipMap[n];
    for (const [csvName, owner] of Object.entries(ownershipMap)) {
        const cn = nameForMatch(csvName);
        const cnComp = compressedName(csvName);
        if (nMatch === cn || nMatch.includes(cn) || cn.includes(nMatch)) return owner;
        if (nComp === cnComp || nComp.includes(cnComp) || cnComp.includes(nComp)) return owner;
    }
    return null;
}

let ownershipMap = {};

function updateFaLegendVisibility() {
    const el = document.getElementById('faLegend');
    if (el) {
        el.classList.toggle('show', Object.keys(ownershipMap).length > 0);
        el.setAttribute('aria-hidden', Object.keys(ownershipMap).length === 0 ? 'true' : 'false');
    }
}

function applyFantasyCsv(text, opts) {
    text = (text || '').trim();
    if (!text) return;
    ownershipMap = parseFantasyCsv(text);
    sessionStorage.setItem(FANTASY_STORAGE, text);
    const btn = document.getElementById('btnUploadRoster');
    if (btn) { btn.textContent = 'Roster Loaded ✓'; btn.classList.add('loaded'); }
    updateFaLegendVisibility();
    render();

    if (opts?.skipClose !== true) {
        document.getElementById('fantasySection').classList.remove('open');
    }

    const toast = document.getElementById('fantasyToast');
    toast.innerHTML = 'Roster imported successfully.';
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3500);
}

function processAndApplyCsv(text) {
    const zone = document.getElementById('fantasyDropZone');
    const bar = document.getElementById('fantasyProgressBar');

    zone.classList.remove('success');
    zone.classList.add('processing');
    bar.style.width = '0%';

    // Animate loading bar 0 -> 100% over ~500ms
    const duration = 500;
    const start = performance.now();
    function tick(now) {
        const elapsed = now - start;
        const pct = Math.min((elapsed / duration) * 100, 100);
        bar.style.width = pct + '%';

        if (pct < 100) {
            requestAnimationFrame(tick);
            return;
        }

        // Bar complete: apply data and show success
        applyFantasyCsv(text, { skipClose: true });

        zone.classList.remove('processing');
        zone.classList.add('success');

        // Close section and reset after showing checkmark
        setTimeout(() => {
            document.getElementById('fantasySection').classList.remove('open');
            zone.classList.remove('success');
            bar.style.width = '0%';
        }, 1400);
    }
    requestAnimationFrame(tick);
}

(function loadFantasyFromStorage() {
    const saved = sessionStorage.getItem(FANTASY_STORAGE);
    if (saved) {
        ownershipMap = parseFantasyCsv(saved);
        const btn = document.getElementById('btnUploadRoster');
        if (btn) { btn.textContent = 'Roster Loaded ✓'; btn.classList.add('loaded'); }
        updateFaLegendVisibility();
    }
})();

(function setupFantasyDropZone() {
    const zone = document.getElementById('fantasyDropZone');
    ['dragenter', 'dragover'].forEach(ev => {
        zone.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); zone.classList.add('drag-over'); });
    });
    ['dragleave', 'drop'].forEach(ev => {
        zone.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); zone.classList.remove('drag-over'); });
    });
    zone.addEventListener('drop', e => {
        const file = e.dataTransfer?.files?.[0];
        if (!file) return;
        if (!/\.(csv|txt)$/i.test(file.name) && !file.type.match(/text\/|csv/)) return;
        const reader = new FileReader();
        reader.onload = () => processAndApplyCsv(reader.result);
        reader.readAsText(file);
    });
    zone.addEventListener('paste', e => {
        e.preventDefault();
        const text = e.clipboardData?.getData('text/plain') || '';
        if (text.trim()) processAndApplyCsv(text);
    });
})();

// ============================================================
// POPULATE FILTER DROPDOWNS
// ============================================================
(function populateFilters() {
    const positions = ['ALL', ...new Set(ALL_PROSPECTS.map(p => p.pos))];
    const teams     = ['ALL', ...new Set(ALL_PROSPECTS.map(p => p.team))].sort();

    const posEl  = document.getElementById('posFilter');
    const teamEl = document.getElementById('teamFilter');

    positions.forEach(v => {
        const o       = document.createElement('option');
        o.value       = v;
        o.textContent = v === 'ALL' ? 'All Positions' : v;
        posEl.appendChild(o);
    });
    teams.forEach(v => {
        const o       = document.createElement('option');
        o.value       = v;
        o.textContent = v === 'ALL' ? 'All Teams' : v;
        teamEl.appendChild(o);
    });
})();

// ============================================================
// RENDER TABLE
// ============================================================
function displayTier(tier) { return (tier === 0 || tier == null) ? 1 : tier; }
function tierClass(tier) {
    if (tier === 0 || tier === 1) return 'rank-tier1';   // Tier 1 = best (0 is legacy)
    if (tier === 2) return 'rank-gold';
    if (tier === 3) return 'rank-silver';
    if (tier === 4) return 'rank-bronze';
    if (tier === 5) return 'rank-tier4';
    return 'rank-steel';
}

function volClass(v) {
    if (v === 'Low')      return 'vol-low';
    if (v === 'Moderate') return 'vol-mod';
    if (v === 'High')     return 'vol-high';
    if (v === 'Extreme')  return 'vol-extreme';
    return 'vol-na';
}

function posClass(pos) {
    const p = (pos || '').toLowerCase();
    if (/^sp$|^rhp$|^lhp$|^p$/.test(p)) return 'pos-sp';
    if (p === 'c') return 'pos-c';
    if (p === '1b') return 'pos-1b';
    if (p === '2b') return 'pos-2b';
    if (p === '3b') return 'pos-3b';
    if (p === 'ss') return 'pos-ss';
    if (p === 'of') return 'pos-of';
    if (p === 'if') return 'pos-if';
    return '';
}

// Normalize name for display: strip "POS Name, TEAM" → "Name" (from pasted source lines)
function displayName(p) {
    const n = (p.name || '').trim();
    const stripped = n
        .replace(/^(C|1B|2B|3B|SS|OF|IF|SP|RP|RHP|LHP|DH|SHP)\s+/i, '')
        .replace(/, [A-Z]{2,3}$/, '');
    return (stripped.length > 0 ? stripped : n);
}

function render() {
    updateFaLegendVisibility();
    const search = document.getElementById('searchInput').value.toLowerCase();
    const pos    = document.getElementById('posFilter').value;
    const team   = document.getElementById('teamFilter').value;
    const vol    = document.getElementById('volFilter').value;

    const filtered = ALL_PROSPECTS.filter(p => {
        if (search && !p.name.toLowerCase().includes(search)) return false;
        if (pos  !== 'ALL' && p.pos  !== pos)  return false;
        if (team !== 'ALL' && p.team !== team) return false;
        if (vol  !== 'ALL' && p.volatility !== vol) return false;
        return true;
    });

    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';

    if (filtered.length === 0) {
        tbody.innerHTML = '<tr class="empty-state-row"><td colspan="9"><div class="empty-state"><span class="empty-icon">🔍</span>No prospects match your filters. Try adjusting search, position, team, or volatility.</div></td></tr>';
        return;
    }

    let lockInserted = false;
    let prevTier = null;

    filtered.forEach(p => {
        const isFree = p.displayRank <= FREE_LIMIT;

        const isFirstInTier = prevTier === null || p.tier !== prevTier;
        if (isFirstInTier) {
            const breakerRow = document.createElement('tr');
            breakerRow.className = 'tier-breaker';
            breakerRow.innerHTML = `<td colspan="9"><div class="tier-breaker-line"><span class="tier-breaker-label">Tier ${displayTier(p.tier)}</span></div></td>`;
            tbody.appendChild(breakerRow);
        }
        prevTier = p.tier;

        // Insert lock wall once, right before the first locked prospect
        if (!isFree && !lockInserted) {
            lockInserted = true;
            const lockRow = document.createElement('tr');
            lockRow.className = 'lock-row';
            lockRow.innerHTML = `
                <td colspan="9">
                    <div class="lock-box">
                        <div class="lock-icon">🔒</div>
                        <div class="lock-title">Unlock Full Rankings</div>
                        <p class="lock-desc">See all 100+ prospects, full volatility analysis, historical tracking, and weekly updates.</p>
                        <button class="btn-unlock">Upgrade to Pro — $7 / mo</button>
                    </div>
                </td>
            `;
            tbody.appendChild(lockRow);
        }

        const tr = document.createElement('tr');
        if (!isFree) tr.className = 'locked-ghost';
        const owner = getOwnerForProspect(p.name);
        if (Object.keys(ownershipMap).length > 0 && !owner) tr.classList.add('free-agent');

        // 6 consensus dots (sources that agreed on position within ±10% percentile)
        const dotsHtml = [1,2,3,4,5,6].map(i =>
            `<div class="cons-dot ${i <= p.consensusAgreement ? 'on' : ''}"></div>`
        ).join('');

        // Single-source warning
        const warnHtml = p.sourceCount === 1
            ? `<span class="warn-badge">⚠ 1 source</span>`
            : '';

        // Rank change arrow (vs previous view): positive change = moved up, negative = moved down
        // Prefer exact name match; fallback to any key that contains or is contained in current name (handles renames)
        let prevRank = PREV_RANK_MAP[p.name];
        if (prevRank == null && p.name) {
            const norm = (s) => (s || '').toLowerCase().replace(/\s+/g, ' ').trim();
            const n = norm(p.name);
            for (const [k, v] of Object.entries(PREV_RANK_MAP)) {
                const kNorm = norm(k);
                if (kNorm === n || kNorm.includes(n) || n.includes(kNorm)) { prevRank = v; break; }
            }
        }
        const rankChange = prevRank != null ? prevRank - p.displayRank : null;
        const showArrow = rankChange != null && Math.abs(rankChange) >= RANK_CHANGE_THRESHOLD;
        const moveCount = showArrow ? Math.abs(rankChange) : 0;
        const arrowHtml = showArrow
            ? (rankChange > 0
                ? `<span class="rank-arrow rank-up" title="Up ${rankChange} spots">↑ ${moveCount}</span>`
                : `<span class="rank-arrow rank-down" title="Down ${moveCount} spots">↓ ${moveCount}</span>`)
            : '';

        tr.innerHTML = `
            <td><div class="rank-change-wrap"><div class="rank-pill ${tierClass(p.tier)}" title="Tier ${displayTier(p.tier)}">#${p.displayRank}</div>${arrowHtml}</div></td>
            <td><div class="p-name">${displayName(p)} ${warnHtml}</div></td>
            <td><span class="pos-badge ${posClass(p.pos)}">${p.pos}</span></td>
            <td class="team-col">${p.team}</td>
            <td class="num-col">${p.age}</td>
            <td class="num-col">${p.eta}</td>
            <td class="borda-col">${p.rankleScore.toFixed(1)}</td>
            <td>
                <span class="vol-badge ${volClass(p.volatility)}">${p.volatility}</span>
            </td>
            <td><div class="cons-dots">${dotsHtml}</div></td>
        `;
        tbody.appendChild(tr);
    });

    // If every filtered result was free, still show the lock wall at the bottom
    // (only if paywall is active)
    if (!lockInserted && FREE_LIMIT < ALL_PROSPECTS.length) {
        const lockRow = document.createElement('tr');
        lockRow.className = 'lock-row';
        lockRow.innerHTML = `
            <td colspan="9">
                <div class="lock-box">
                    <div class="lock-icon">🔒</div>
                    <div class="lock-title">Unlock Full Rankings</div>
                    <p class="lock-desc">See all 100+ prospects, full volatility analysis, historical tracking, and weekly updates.</p>
                    <button class="btn-unlock">Upgrade to Pro — $7 / mo</button>
                </div>
            </td>
        `;
        tbody.appendChild(lockRow);
    }
}

// ── Wire up filters & initial render ──
document.getElementById('searchInput').addEventListener('input',  render);
document.getElementById('posFilter').addEventListener('change',  render);
document.getElementById('teamFilter').addEventListener('change', render);
document.getElementById('volFilter').addEventListener('change',  render);
render();

</script>
</body>
</html>

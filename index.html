<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rankle ‚Äì Consensus MLB Prospect Rankings</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --bg-deep:    #0a0e1a;
    --bg-card:    #111827;
    --bg-row:     #151c2e;
    --bg-row-alt: #0f1522;
    --border:     #1e2a40;
    --text-hi:    #f1f5f9;
    --text-mid:   #94a3b8;
    --text-lo:    #4c5a72;
    --accent:     #3b82f6;
    --accent-hi:  #60a5fa;
    --gold:       #f59e0b;
    --green:      #34d399;
    --red:        #f87171;
    --purple:     #a78bfa;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg-deep);
    color: var(--text-hi);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
    position: sticky; top: 0; z-index: 100;
    background: rgba(10,14,26,0.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    padding: 0 2rem;
    height: 64px;
    display: flex; align-items: center; justify-content: space-between;
}
.logo { display:flex; align-items:center; gap:0.75rem; }
.logo-icon {
    width:40px; height:40px;
    background: linear-gradient(135deg,#3b82f6,#2563eb);
    border-radius:10px;
    display:flex; align-items:center; justify-content:center;
    font-family:'Bebas Neue',cursive; font-size:1.4rem; color:#fff;
    letter-spacing:1px;
}
.logo-title { font-family:'Bebas Neue',cursive; font-size:1.7rem; letter-spacing:2px; color:#fff; }
.logo-sub { font-size:0.72rem; color:var(--text-lo); text-transform:uppercase; letter-spacing:1.5px; margin-left:0.25rem; }

.header-right { display:flex; align-items:center; gap:1rem; }
.btn-pro {
    background: linear-gradient(135deg,#7c3aed,#6366f1);
    color:#fff; border:none; padding:0.45rem 1rem;
    border-radius:6px; font-size:0.8rem; font-weight:600;
    cursor:pointer; letter-spacing:0.3px;
    transition: transform .15s, box-shadow .15s;
}
.btn-pro:hover { transform:translateY(-1px); box-shadow:0 4px 14px rgba(99,102,241,.4); }

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero {
    background: linear-gradient(160deg, #0f1d3a 0%, #0a0e1a 70%);
    border-bottom: 1px solid var(--border);
    padding: 2.75rem 2rem 2.25rem;
    text-align: center;
}
.hero h1 { font-family:'Bebas Neue',cursive; font-size:2.9rem; letter-spacing:3px; margin-bottom:.4rem; }
.hero p { color:var(--text-mid); font-size:1rem; max-width:560px; margin:0 auto .8rem; line-height:1.5; }
.hero-pills { display:flex; justify-content:center; gap:1.25rem; flex-wrap:wrap; }
.hero-pill { font-size:.78rem; color:#7dd3fc; display:flex; align-items:center; gap:.35rem; }
.hero-pill span.ico { font-size:1rem; }

/* ‚îÄ‚îÄ STAT BAR ‚îÄ‚îÄ */
.stat-bar {
    display: grid;
    grid-template-columns: repeat(4,1fr);
    gap: 1px;
    background: var(--border);
    border-bottom: 1px solid var(--border);
}
.stat-item {
    background: var(--bg-deep);
    padding: 1.1rem 1rem;
    text-align:center;
}
.stat-val { font-family:'Bebas Neue',cursive; font-size:1.6rem; letter-spacing:1px; color:#fff; }
.stat-lbl { font-size:.7rem; color:var(--text-lo); text-transform:uppercase; letter-spacing:1.2px; margin-top:.15rem; }

/* ‚îÄ‚îÄ FILTER BAR ‚îÄ‚îÄ */
.filter-bar {
    max-width:1100px; margin: 1.5rem auto 1rem;
    padding: 0 1.5rem;
    display:flex; gap:.75rem; align-items:flex-end; flex-wrap:wrap;
}
.filter-group { display:flex; flex-direction:column; gap:.3rem; flex:1; min-width:140px; }
.filter-group label { font-size:.7rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-lo); }
.filter-group input,
.filter-group select {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius:6px;
    padding: .5rem .7rem;
    color: var(--text-hi);
    font-size:.85rem;
    font-family: inherit;
    outline:none;
    transition: border-color .2s;
}
.filter-group input:focus,
.filter-group select:focus { border-color: var(--accent); }
.filter-group input::placeholder { color:var(--text-lo); }

/* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
.table-wrap {
    max-width:1100px; margin:0 auto 2rem;
    padding:0 1.5rem;
}
table { width:100%; border-collapse:collapse; }

thead th {
    text-align:left;
    font-size:.68rem; text-transform:uppercase; letter-spacing:1.3px;
    color:var(--text-lo); font-weight:600;
    padding:.7rem .65rem;
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
}
thead th:first-child { padding-left:1rem; }

tbody tr {
    border-bottom: 1px solid var(--border);
    transition: background .15s;
}
tbody tr:nth-child(odd)  { background: var(--bg-row); }
tbody tr:nth-child(even) { background: var(--bg-row-alt); }
tbody tr:hover           { background: rgba(59,130,246,.07); }

td { padding:.75rem .65rem; vertical-align:middle; }
td:first-child { padding-left:1rem; }

/* rank pill */
.rank-pill {
    display:inline-flex; align-items:center; justify-content:center;
    width:38px; height:38px; border-radius:8px;
    font-weight:700; font-size:.88rem;
}
.rank-gold   { background:linear-gradient(135deg,#f59e0b,#d97706); color:#1a1a1a; box-shadow:0 2px 8px rgba(245,158,11,.35); }
.rank-silver { background:linear-gradient(135deg,#cbd5e1,#94a3b8); color:#1a1a1a; box-shadow:0 2px 6px rgba(148,163,175,.3); }
.rank-bronze { background:linear-gradient(135deg,#f97316,#ea580c); color:#fff;    box-shadow:0 2px 6px rgba(249,115,22,.35); }
.rank-steel  { background:var(--bg-card); color:var(--text-mid); border:1px solid var(--border); }

/* name col */
.p-name { font-weight:600; font-size:.9rem; color:var(--text-hi); }

/* pos badge */
.pos-badge {
    display:inline-block; padding:.2rem .55rem;
    border-radius:20px; font-size:.72rem; font-weight:600;
    background:rgba(59,130,246,.15); color:#7dd3fc;
}

.team-col { font-weight:600; font-size:.85rem; color:var(--text-mid); }
.num-col  { font-size:.85rem; color:var(--text-mid); }

/* borda score */
.borda-col { font-weight:700; font-size:.9rem; color:var(--accent-hi); }

/* median */
.median-col { font-size:.85rem; color:var(--text-mid); font-weight:600; }

/* SD / volatility */
.vol-wrap { display:flex; align-items:center; gap:.45rem; }
.vol-num  { font-size:.78rem; color:var(--text-mid); font-weight:500; }
.vol-badge {
    font-size:.65rem; font-weight:700; text-transform:uppercase;
    letter-spacing:.8px; padding:.15rem .42rem; border-radius:4px;
}
.vol-low  { background:rgba(52,211,153,.15); color:#34d399; }
.vol-mod  { background:rgba(251,191,36,.15); color:#fbbf24; }
.vol-high { background:rgba(248,113,113,.15); color:#f87171; }
.vol-na   { background:rgba(100,116,139,.15); color:var(--text-lo); }

/* consensus dots */
.cons-dots { display:flex; gap:.3rem; }
.cons-dot  { width:8px; height:8px; border-radius:50%; background:var(--border); }
.cons-dot.on { background:var(--gold); box-shadow:0 0 4px rgba(245,158,11,.4); }

/* single-source warning */
.warn-badge {
    display:inline-flex; align-items:center; gap:.25rem;
    font-size:.68rem; color:#fbbf24; font-weight:600;
    background:rgba(251,191,36,.1); padding:.12rem .4rem; border-radius:4px;
    margin-left:.4rem;
}

/* ‚îÄ‚îÄ LOCKED SECTION ‚îÄ‚îÄ */
.lock-row td { padding:0; border:none !important; }
.lock-box {
    background: linear-gradient(135deg, rgba(17,24,39,0.95), rgba(10,14,26,0.98));
    border: 1px solid var(--border);
    border-radius:14px;
    padding:2.5rem 2rem;
    text-align:center;
    max-width:420px; margin:1.8rem auto;
}
.lock-icon { font-size:2.8rem; margin-bottom:.6rem; }
.lock-title { font-family:'Bebas Neue',cursive; font-size:1.55rem; letter-spacing:2px; margin-bottom:.35rem; }
.lock-desc { color:var(--text-mid); font-size:.82rem; line-height:1.5; margin-bottom:1.2rem; max-width:320px; margin-left:auto; margin-right:auto; }
.btn-unlock {
    background: linear-gradient(135deg,#2563eb,#1d4ed8);
    color:#fff; border:none; padding:.6rem 1.6rem;
    border-radius:8px; font-size:.92rem; font-weight:700;
    cursor:pointer; transition: transform .15s, box-shadow .15s;
    box-shadow: 0 3px 16px rgba(37,99,235,.4);
}
.btn-unlock:hover { transform:translateY(-2px); box-shadow:0 6px 24px rgba(37,99,235,.5); }

.locked-ghost { opacity:.28; filter:blur(3.5px); pointer-events:none; user-select:none; }

/* ‚îÄ‚îÄ METHODOLOGY ‚îÄ‚îÄ */
.method-section {
    max-width:1100px; margin: 0 auto 2.5rem;
    padding: 0 1.5rem;
}
.method-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius:12px;
    padding:2rem;
}
.method-card h3 { font-family:'Bebas Neue',cursive; font-size:1.3rem; letter-spacing:2px; margin-bottom:1rem; color:#fff; }
.method-grid { display:grid; grid-template-columns:1fr 1fr; gap:2rem; }
.method-item h4 { font-size:.82rem; color:var(--accent-hi); font-weight:600; margin-bottom:.35rem; text-transform:uppercase; letter-spacing:0.8px; }
.method-item p  { font-size:.8rem; color:var(--text-mid); line-height:1.65; }

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
footer {
    border-top: 1px solid var(--border);
    padding: 2rem 1.5rem;
    text-align:center;
    color:var(--text-lo); font-size:.73rem;
    margin-top:1rem;
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width:700px) {
    .stat-bar { grid-template-columns:repeat(2,1fr); }
    .method-grid { grid-template-columns:1fr; }
    thead th, td { padding:.6rem .4rem; font-size:.78rem; }
    .vol-num { display:none; }
    header { padding:0 1rem; }
    .hero { padding:1.8rem 1rem 1.5rem; }
    .hero h1 { font-size:2rem; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header>
    <div class="logo">
        <div class="logo-icon">PR</div>
        <div>
            <span class="logo-title">Rankle</span>
            <span class="logo-sub">‚öæ Consensus</span>
        </div>
    </div>
    <div class="header-right">
        <button class="btn-pro">‚≠ê Upgrade to Pro</button>
    </div>
</header>

<!-- HERO -->
<div class="hero">
    <h1>MLB Prospect Rankings</h1>
    <p>Aggregated from 6+ trusted sources using a normalized Borda Count algorithm. Volatility scores reveal how much sources disagree on each prospect.</p>
    <div class="hero-pills">
        <div class="hero-pill"><span class="ico">üìä</span> Normalized across list lengths</div>
        <div class="hero-pill"><span class="ico">üìà</span> Volatility scoring</div>
        <div class="hero-pill"><span class="ico">üîÑ</span> Updated weekly</div>
    </div>
</div>

<!-- STAT BAR -->
<div class="stat-bar">
    <div class="stat-item"><div class="stat-val" id="statSources">6</div><div class="stat-lbl">Sources</div></div>
    <div class="stat-item"><div class="stat-val" id="statProspects">‚Äì</div><div class="stat-lbl">Prospects</div></div>
    <div class="stat-item"><div class="stat-val" id="statConsensus">‚Äì</div><div class="stat-lbl">High Consensus</div></div>
    <div class="stat-item"><div class="stat-val" id="statLowVol">‚Äì</div><div class="stat-lbl">Low Volatility</div></div>
</div>

<!-- FILTERS -->
<div class="filter-bar">
    <div class="filter-group" style="flex:2;">
        <label>Search</label>
        <input type="text" id="searchInput" placeholder="Player name or team‚Ä¶">
    </div>
    <div class="filter-group">
        <label>Position</label>
        <select id="posFilter"></select>
    </div>
    <div class="filter-group">
        <label>Team</label>
        <select id="teamFilter"></select>
    </div>
    <div class="filter-group">
        <label>Volatility</label>
        <select id="volFilter">
            <option value="ALL">All</option>
            <option value="Low">Low</option>
            <option value="Moderate">Moderate</option>
            <option value="High">High</option>
        </select>
    </div>
</div>

<!-- TABLE -->
<div class="table-wrap">
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Player</th>
                <th>Pos</th>
                <th>Team</th>
                <th>Age</th>
                <th>ETA</th>
                <th>Borda</th>
                <th>Median</th>
                <th>Volatility</th>
                <th>Consensus</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
</div>

<!-- METHODOLOGY -->
<div class="method-section">
    <div class="method-card">
        <h3>Our Methodology</h3>
        <div class="method-grid">
            <div class="method-item">
                <h4>Percentile Normalization</h4>
                <p>Raw ranks are converted to a 0‚Äì100 scale using the formula <strong style="color:var(--accent-hi);">score = 100 √ó (1 ‚àí (rank‚àí1) / (N‚àí1))</strong>. This means #1 on a Top-100 list scores identically to #1 on a Top-500 list. Being in the top 10% of any list produces the same normalized score regardless of list length.</p>
            </div>
            <div class="method-item">
                <h4>Borda Count Aggregation</h4>
                <p>Each source contributes a normalized score. We average those scores across all sources that ranked a given prospect to produce the final Borda score (0‚Äì100). This rewards appearing on many lists while keeping single-source prospects fairly compared.</p>
            </div>
            <div class="method-item">
                <h4>Median Rank</h4>
                <p>The median of all raw ranks a prospect received across sources. Kept in raw-rank form intentionally ‚Äî "typically ranked around #12" is more intuitive than an abstract score. Resistant to outlier rankings from any single source.</p>
            </div>
            <div class="method-item">
                <h4>Volatility (Standard Deviation)</h4>
                <p>Sample standard deviation of normalized scores across sources. <strong style="color:var(--green);">Low (&lt;10)</strong> = sources agree. <strong style="color:#fbbf24;">Moderate (10‚Äì25)</strong> = some disagreement. <strong style="color:var(--red);">High (&gt;25)</strong> = significant divergence. Requires 2+ sources; single-source prospects are flagged.</p>
            </div>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer>
    ¬© 2026 Rankle. Rankings are transformative works aggregated from publicly available sources. We analyze data from MLB Pipeline, Baseball America, FanGraphs, Bleacher Report, ESPN, and Just Baseball.
</footer>

<script>
// ============================================================
// RANKING ENGINE  ‚Äî unit-tested & verified before deployment
// ============================================================

// Normalize a single rank to 0‚Äì100 given the source list length.
// rank 1 ‚Üí 100, rank N ‚Üí 0, linear between.
function normalizeScore(rank, listLength) {
    if (listLength <= 1) return 100;
    return 100 * (1 - (rank - 1) / (listLength - 1));
}

// Given player meta and an array of { source, rank, listLength },
// return the full computed prospect object.
function computeProspect(meta, sourceRankings) {
    const scores   = sourceRankings.map(s => normalizeScore(s.rank, s.listLength));
    const rawRanks = sourceRankings.map(s => s.rank);
    const n        = sourceRankings.length;

    // Borda = mean of normalized scores across sources that ranked this prospect
    const bordaAvg = scores.reduce((a, b) => a + b, 0) / n;

    // Median of raw ranks (intuitive for users)
    const sorted = [...rawRanks].sort((a, b) => a - b);
    const mid    = Math.floor(sorted.length / 2);
    const median = sorted.length % 2 !== 0
        ? sorted[mid]
        : (sorted[mid - 1] + sorted[mid]) / 2;

    // Sample standard deviation of normalized scores (volatility)
    let sd = null, volatility = "N/A";
    if (n >= 2) {
        const variance = scores.reduce((sum, s) => sum + (s - bordaAvg) ** 2, 0) / (n - 1);
        sd = Math.sqrt(variance);
        volatility = sd < 10 ? "Low" : sd < 25 ? "Moderate" : "High";
    }

    return { ...meta, sourceCount: n, bordaAvg, median, sd, volatility };
}

// ============================================================
// SOURCE DEFINITIONS
// Each source has its own list length ‚Äî this is what makes
// normalization matter. Change these as you add real sources.
// ============================================================
const SOURCES = {
    pipeline:     { label: "MLB Pipeline",     listLength: 100 },
    ba:           { label: "Baseball America", listLength: 100 },
    fangraphs:    { label: "FanGraphs",        listLength: 100 },
    br:           { label: "Bleacher Report",  listLength: 100 },
    espn:         { label: "ESPN",             listLength: 100 },
    justbaseball: { label: "Just Baseball",    listLength: 100 }
};

// ============================================================
// RAW SOURCE DATA
// null = prospect was NOT on that source's list.
// To add a new source: add a key to SOURCES, add a column here.
// To change a list length: edit SOURCES[key].listLength.
// ============================================================
const RAW_DATA = [
    { name:"Kevin McGonigle",    pos:"SS",  team:"DET", age:19, eta:"2027", ranks:{ pipeline:7,  ba:3,  fangraphs:5,  br:1,  espn:4,  justbaseball:6  } },
    { name:"Konnor Griffin",     pos:"SS",  team:"PIT", age:18, eta:"2028", ranks:{ pipeline:13, ba:1,  fangraphs:8,  br:2,  espn:null, justbaseball:1 } },
    { name:"Jes√∫s Made",         pos:"SS",  team:"MIL", age:18, eta:"2027", ranks:{ pipeline:8,  ba:5,  fangraphs:6,  br:3,  espn:7,  justbaseball:2  } },
    { name:"Bubba Chandler",     pos:"RHP", team:"PIT", age:22, eta:"2026", ranks:{ pipeline:15, ba:4,  fangraphs:9,  br:4,  espn:5,  justbaseball:4  } },
    { name:"Walker Jenkins",     pos:"OF",  team:"MIN", age:19, eta:"2027", ranks:{ pipeline:3,  ba:8,  fangraphs:7,  br:21, espn:6,  justbaseball:5  } },
    { name:"Leo De Vries",       pos:"SS",  team:"ATH", age:20, eta:"2026", ranks:{ pipeline:18, ba:2,  fangraphs:4,  br:6,  espn:3,  justbaseball:null} },
    { name:"Max Clark",          pos:"OF",  team:"DET", age:20, eta:"2027", ranks:{ pipeline:6,  ba:9,  fangraphs:null,br:17, espn:8,  justbaseball:3  } },
    { name:"JJ Wetherholt",      pos:"SS",  team:"STL", age:21, eta:"2026", ranks:{ pipeline:23, ba:6,  fangraphs:10, br:7,  espn:9,  justbaseball:7  } },
    { name:"Samuel Basallo",     pos:"C",   team:"BAL", age:20, eta:"2026", ranks:{ pipeline:11, ba:7,  fangraphs:12, br:8,  espn:11, justbaseball:null} },
    { name:"Andrew Painter",     pos:"RHP", team:"PHI", age:22, eta:"2026", ranks:{ pipeline:8,  ba:10, fangraphs:11, br:14, espn:10, justbaseball:null} },
    { name:"Nolan McLean",       pos:"RHP", team:"NYM", age:23, eta:"2025", ranks:{ pipeline:null,ba:11, fangraphs:14, br:9,  espn:12, justbaseball:8  } },
    { name:"Sebastian Walcott",  pos:"SS",  team:"TEX", age:19, eta:"2027", ranks:{ pipeline:4,  ba:null,fangraphs:null,br:5, espn:null, justbaseball:null} },
    { name:"Trey Yesavage",      pos:"RHP", team:"TOR", age:23, eta:"2025", ranks:{ pipeline:null,ba:null,fangraphs:15,br:10, espn:14, justbaseball:9  } },
    { name:"Bryce Eldridge",     pos:"1B",  team:"SF",  age:20, eta:"2027", ranks:{ pipeline:24, ba:12, fangraphs:null,br:11, espn:15, justbaseball:null} },
    { name:"Colt Emerson",       pos:"SS",  team:"SEA", age:20, eta:"2027", ranks:{ pipeline:20, ba:14, fangraphs:16, br:12, espn:null, justbaseball:null} },
    { name:"Thomas White",       pos:"LHP", team:"MIA", age:21, eta:"2026", ranks:{ pipeline:41, ba:13, fangraphs:null,br:13, espn:16, justbaseball:null} },
    { name:"Josue De Paula",     pos:"OF",  team:"LAD", age:19, eta:"2028", ranks:{ pipeline:40, ba:15, fangraphs:18, br:15, espn:null, justbaseball:null} },
    { name:"Ethan Holliday",     pos:"SS",  team:"COL", age:18, eta:"2028", ranks:{ pipeline:null,ba:16, fangraphs:null,br:16, espn:null, justbaseball:null} },
    { name:"Travis Bazzana",     pos:"2B",  team:"CLE", age:22, eta:"2026", ranks:{ pipeline:10, ba:18, fangraphs:19, br:25, espn:13, justbaseball:null} },
    { name:"Eli Willits",        pos:"SS",  team:"WAS", age:18, eta:"2028", ranks:{ pipeline:null,ba:20, fangraphs:null,br:24, espn:null, justbaseball:null} },
    { name:"Luis Pe√±a",          pos:"SS",  team:"MIL", age:19, eta:"2027", ranks:{ pipeline:null,ba:17, fangraphs:null,br:19, espn:null, justbaseball:null} },
    { name:"Kade Anderson",      pos:"LHP", team:"SEA", age:21, eta:"2026", ranks:{ pipeline:null,ba:19, fangraphs:null,br:20, espn:null, justbaseball:null} },
    { name:"Noah Schultz",       pos:"LHP", team:"CWS", age:22, eta:"2026", ranks:{ pipeline:null,ba:22, fangraphs:20, br:28, espn:null, justbaseball:null} },
    { name:"Carson Benge",       pos:"OF",  team:"NYM", age:21, eta:"2026", ranks:{ pipeline:null,ba:21, fangraphs:null,br:29, espn:18, justbaseball:null} },
    { name:"Moises Ballesteros", pos:"C",   team:"CHC", age:21, eta:"2026", ranks:{ pipeline:null,ba:23, fangraphs:null,br:30, espn:19, justbaseball:null} },
];

// ============================================================
// BUILD + SORT
// ============================================================
function buildProspects() {
    return RAW_DATA.map(row => {
        const sourceRankings = [];
        for (const [key, val] of Object.entries(row.ranks)) {
            if (val !== null) {
                sourceRankings.push({ source: key, rank: val, listLength: SOURCES[key].listLength });
            }
        }
        return computeProspect(
            { name: row.name, pos: row.pos, team: row.team, age: row.age, eta: row.eta },
            sourceRankings
        );
    })
    .sort((a, b) => b.bordaAvg - a.bordaAvg)          // primary: Borda descending
    .map((p, i) => ({ ...p, displayRank: i + 1 }));   // assign final display rank
}

const ALL_PROSPECTS = buildProspects();
const FREE_LIMIT    = 999;  // ‚Üê no paywall during development

// ============================================================
// POPULATE FILTER DROPDOWNS
// ============================================================
(function populateFilters() {
    const positions = ['ALL', ...new Set(ALL_PROSPECTS.map(p => p.pos))];
    const teams     = ['ALL', ...new Set(ALL_PROSPECTS.map(p => p.team))].sort();

    const posEl  = document.getElementById('posFilter');
    const teamEl = document.getElementById('teamFilter');

    positions.forEach(v => {
        const o       = document.createElement('option');
        o.value       = v;
        o.textContent = v === 'ALL' ? 'All Positions' : v;
        posEl.appendChild(o);
    });
    teams.forEach(v => {
        const o       = document.createElement('option');
        o.value       = v;
        o.textContent = v === 'ALL' ? 'All Teams' : v;
        teamEl.appendChild(o);
    });
})();

// ============================================================
// RENDER TABLE
// ============================================================
function rankClass(r) {
    if (r <= 3)  return 'rank-gold';
    if (r <= 6)  return 'rank-silver';
    if (r <= 10) return 'rank-bronze';
    return 'rank-steel';
}

function volClass(v) {
    if (v === 'Low')      return 'vol-low';
    if (v === 'Moderate') return 'vol-mod';
    if (v === 'High')     return 'vol-high';
    return 'vol-na';
}

function render() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const pos    = document.getElementById('posFilter').value;
    const team   = document.getElementById('teamFilter').value;
    const vol    = document.getElementById('volFilter').value;

    const filtered = ALL_PROSPECTS.filter(p => {
        if (search && !p.name.toLowerCase().includes(search) && !p.team.toLowerCase().includes(search)) return false;
        if (pos  !== 'ALL' && p.pos  !== pos)  return false;
        if (team !== 'ALL' && p.team !== team) return false;
        if (vol  !== 'ALL' && p.volatility !== vol) return false;
        return true;
    });

    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';

    let lockInserted = false;

    filtered.forEach(p => {
        const isFree = p.displayRank <= FREE_LIMIT;

        // Insert lock wall once, right before the first locked prospect
        if (!isFree && !lockInserted) {
            lockInserted = true;
            const lockRow = document.createElement('tr');
            lockRow.className = 'lock-row';
            lockRow.innerHTML = `
                <td colspan="10">
                    <div class="lock-box">
                        <div class="lock-icon">üîí</div>
                        <div class="lock-title">Unlock Full Rankings</div>
                        <p class="lock-desc">See all 100+ prospects, full volatility analysis, historical tracking, and weekly updates.</p>
                        <button class="btn-unlock">Upgrade to Pro ‚Äî $7 / mo</button>
                    </div>
                </td>
            `;
            tbody.appendChild(lockRow);
        }

        const tr = document.createElement('tr');
        if (!isFree) tr.className = 'locked-ghost';

        // 6 consensus dots
        const dotsHtml = [1,2,3,4,5,6].map(i =>
            `<div class="cons-dot ${i <= p.sourceCount ? 'on' : ''}"></div>`
        ).join('');

        // Single-source warning
        const warnHtml = p.sourceCount === 1
            ? `<span class="warn-badge">‚ö† 1 source</span>`
            : '';

        tr.innerHTML = `
            <td><div class="rank-pill ${rankClass(p.displayRank)}">#${p.displayRank}</div></td>
            <td><div class="p-name">${p.name} ${warnHtml}</div></td>
            <td><span class="pos-badge">${p.pos}</span></td>
            <td class="team-col">${p.team}</td>
            <td class="num-col">${p.age}</td>
            <td class="num-col">${p.eta}</td>
            <td class="borda-col">${p.bordaAvg.toFixed(1)}</td>
            <td class="median-col">#${p.median}</td>
            <td>
                <div class="vol-wrap">
                    <span class="vol-num">${p.sd !== null ? p.sd.toFixed(1) : '‚Äî'}</span>
                    <span class="vol-badge ${volClass(p.volatility)}">${p.volatility}</span>
                </div>
            </td>
            <td><div class="cons-dots">${dotsHtml}</div></td>
        `;
        tbody.appendChild(tr);
    });

    // If every filtered result was free, still show the lock wall at the bottom
    if (!lockInserted) {
        const lockRow = document.createElement('tr');
        lockRow.className = 'lock-row';
        lockRow.innerHTML = `
            <td colspan="10">
                <div class="lock-box">
                    <div class="lock-icon">üîí</div>
                    <div class="lock-title">Unlock Full Rankings</div>
                    <p class="lock-desc">See all 100+ prospects, full volatility analysis, historical tracking, and weekly updates.</p>
                    <button class="btn-unlock">Upgrade to Pro ‚Äî $7 / mo</button>
                </div>
            </td>
        `;
        tbody.appendChild(lockRow);
    }

    // Update stat bar
    document.getElementById('statProspects').textContent  = ALL_PROSPECTS.length;
    document.getElementById('statConsensus').textContent  = ALL_PROSPECTS.filter(p => p.sourceCount >= 4).length;
    document.getElementById('statLowVol').textContent     = ALL_PROSPECTS.filter(p => p.volatility === 'Low').length;
}

// ‚îÄ‚îÄ Wire up filters & initial render ‚îÄ‚îÄ
document.getElementById('searchInput').addEventListener('input',  render);
document.getElementById('posFilter').addEventListener('change',  render);
document.getElementById('teamFilter').addEventListener('change', render);
document.getElementById('volFilter').addEventListener('change',  render);
render();
</script>
</body>
</html>